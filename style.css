/* Custom Font */
body {
    font-family: 'Open Sans', sans-serif;
    overflow-x: hidden; /* Prevent horizontal scroll from cloud shapes */
}
.font-title {
    font-family: 'Fredoka One', cursive;
}

/* --- NEW ANIMATED GAME-LIKE THEME --- */

/* Bubbly Button Effects */
.bubbly-button {
    transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
    will-change: transform;
}
.bubbly-button:active {
    transform: scale(0.95);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Wobble Animation */
@keyframes wobble {
    0%, 100% { transform: rotate(-1deg); }
    50% { transform: rotate(1deg); }
}
.wobble {
    animation: wobble 2s ease-in-out infinite;
}

/* Wobbly Text (for login) */
@keyframes wobbly-text {
    0%, 100% { transform: scale(1); }
    25% { transform: scale(1.02) rotate(-1deg); }
    75% { transform: scale(0.98) rotate(1deg); }
}
.wobbly-title {
    animation: wobbly-text 4s ease-in-out infinite;
    display: inline-block;
}

@keyframes subtle-pulse-title {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.9; }
}
.login-title-pulse {
    animation: subtle-pulse-title 5s ease-in-out infinite;
}


/* Pop-in Animation (now transition-based for flexibility) */
.pop-in {
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease-out;
    will-change: transform, opacity;
    opacity: 1;
    transform: scale(1);
}
.modal-origin-start, .pop-in-start {
    transform: scale(0);
    opacity: 0;
}


/* FIX: Pop-out Animation for Modals */
@keyframes pop-out {
    from { transform: scale(1); opacity: 1; }
    to { transform: scale(0.95); opacity: 0; }
}
.pop-out {
    animation: pop-out 0.2s ease-in forwards;
}


/* NEW: Sparkle animation for star counters */
@keyframes sparkle {
    0%, 100% { 
        transform: scale(1);
        filter: brightness(1);
    }
    50% { 
        transform: scale(1.1); 
        filter: brightness(1.5) drop-shadow(0 0 5px #FBBF24);
    }
}
.sparkle {
    animation: sparkle 0.5s ease-out;
}

@keyframes soft-pulse {
    0%, 100% { transform: scale(1); filter: brightness(1); }
    50% { transform: scale(1.02); filter: brightness(1.1); }
}
.pulse-subtle {
    animation: soft-pulse 4s ease-in-out infinite;
    display: inline-block;
    will-change: transform;
}

@keyframes jump {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
}
.date-char {
    display: inline-block;
    transition: transform 0.2s ease-out;
    color: #FFFFFF; 
}
.date-bounce:hover .date-char {
    animation: jump 0.6s ease-in-out infinite;
}

/* Day-Specific Shadow Colors */
.shadow-mon { text-shadow: 0 0 5px #FBBF24, 0 0 10px #FBBF24; } /* Amber */
.shadow-tue { text-shadow: 0 0 5px #06B6D4, 0 0 10px #06B6D4; } /* Cyan */
.shadow-wed { text-shadow: 0 0 5px #10B981, 0 0 10px #10B981; } /* Emerald */
.shadow-thu { text-shadow: 0 0 5px #6366F1, 0 0 10px #6366F1; } /* Indigo */
.shadow-fri { text-shadow: 0 0 5px #F472B6, 0 0 10px #F472B6; } /* Pink */
.shadow-sat { text-shadow: 0 0 5px #8B5CF6, 0 0 10px #8B5CF6; } /* Violet */
.shadow-sun { text-shadow: 0 0 5px #F87171, 0 0 10px #F87171; } /* Red */


/* --- NEW NAVIGATION BAR STYLES --- */
@keyframes nav-pop {
    0% { transform: scale(0.9); }
    80% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.nav-button {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    border-radius: 1rem;
    color: white;
    transition: all 150ms ease-out;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    border-bottom: 4px solid rgba(0,0,0,0.2);
    transform: scale(0.95);
    opacity: 0.8;
}
.nav-button .icon {
    font-size: 1.25rem;
}
.nav-button .text {
    font-size: 0.75rem;
    font-weight: 700;
    display: none;
}
@media (min-width: 768px) {
    .nav-button .text {
        display: block;
    }
}

.nav-button.active {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transform: scale(1);
    opacity: 1;
    border-bottom-width: 2px;
    animation: nav-pop 0.2s ease-out;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 2px 4px rgba(0,0,0,0.4);
}

/* Individual Nav Button Colors */
.nav-color-cyan { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #06b6d4; --tw-gradient-to: #22d3ee; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #0891B2; }
.nav-color-cyan.active { --tw-gradient-from: #22d3ee; --tw-gradient-to: #67e8f9; }
.nav-color-amber { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #f59e0b; --tw-gradient-to: #fbbf24; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #B45309; }
.nav-color-amber.active { --tw-gradient-from: #fbbf24; --tw-gradient-to: #fcd34d; }
.nav-color-purple { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #a855f7; --tw-gradient-to: #c084fc; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #5B21B6; }
.nav-color-purple.active { --tw-gradient-from: #c084fc; --tw-gradient-to: #d8b4fe; }
.nav-color-green { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #22c55e; --tw-gradient-to: #4ade80; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #047857; }
.nav-color-green.active { --tw-gradient-from: #4ade80; --tw-gradient-to: #86efac; }
.nav-color-rose { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #f43f5e; --tw-gradient-to: #fb7185; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #9F1239; }
.nav-color-rose.active { --tw-gradient-from: #fb7185; --tw-gradient-to: #fda4af; }
.nav-color-blue { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #3b82f6; --tw-gradient-to: #60a5fa; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #1D4ED8; }
.nav-color-blue.active { --tw-gradient-from: #60a5fa; --tw-gradient-to: #93c5fd; }
.nav-color-indigo { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #6366f1; --tw-gradient-to: #818cf8; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #3730A3; }
.nav-color-indigo.active { --tw-gradient-from: #818cf8; --tw-gradient-to: #a5b4fc; }
.nav-color-gray { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #6b7280; --tw-gradient-to: #9ca3af; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #374151; }
.nav-color-gray.active { --tw-gradient-from: #9ca3af; --tw-gradient-to: #d1d5db; }
.nav-color-teal { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #14b8a6; --tw-gradient-to: #2dd4bf; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #0F766E; }
.nav-color-teal.active { --tw-gradient-from: #2dd4bf; --tw-gradient-to: #5eead4; }
.nav-color-scroll { background-image: linear-gradient(to top, var(--tw-gradient-stops)); --tw-gradient-from: #d97706; --tw-gradient-to: #f59e0b; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); border-bottom-color: #9A3412; }
.nav-color-scroll.active { --tw-gradient-from: #f59e0b; --tw-gradient-to: #fbbf24; }

/* New Header with Swirling Clouds */
@keyframes swirl {
    0% { transform: translateX(-100%) translateY(-20px) rotate(-10deg); opacity: 0; }
    10% { opacity: 0.7; }
    90% { opacity: 0.7; }
    100% { transform: translateX(100vw) translateY(20px) rotate(10deg); opacity: 0; }
}
.cloud {
    position: absolute;
    font-size: 8rem;
    color: rgba(255, 255, 255, 0.5);
    animation: swirl 30s linear infinite;
    z-index: 1;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 2px 2px 5px rgba(100, 150, 255, 0.5);
}
.cloud-fast {
    animation-duration: 35s;
}

/* --- V3.5: Upgraded Praise Toast (V4.1.2 Fix) --- */
@keyframes praise-pop {
    0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
    60% { transform: scale(1.1) rotate(5deg); opacity: 1; }
    80% { transform: scale(0.95) rotate(-2deg); }
    100% { transform: scale(1) rotate(0deg); }
}

@keyframes praise-pop-out {
    0% { transform: scale(1) rotate(0deg); opacity: 1; }
    20% { transform: scale(1.05) rotate(-2deg); opacity: 1; }
    100% { transform: scale(0.5) rotate(10deg); opacity: 0; }
}

.praise-toast {
    position: relative;
    background: white;
    border-radius: 50% 60% 70% 40% / 60% 70% 50% 60%; /* Cute cloud shape */
    width: 350px; /* V4.1.2: Made smaller */
    max-width: 90vw;
    padding: 1.75rem 2.5rem; 
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    border: 4px solid #FDE68A;
    animation: praise-pop 0.5s ease-out forwards;
}
.praise-toast.disappearing {
    animation: praise-pop-out 0.4s ease-in forwards;
}
.praise-toast-content {
    display: flex;
    align-items: center;
    gap: 0.75rem; /* 12px */
}
.praise-toast-text {
    font-size: 1.25rem; 
    font-weight: 600;
    color: #4B5563; /* gray-600 */
    line-height: 1.4;
}
.praise-toast-icon {
    font-size: 2.25rem; 
}

/* --- V4.7: REDESIGNED AWARD STARS STYLES --- */
@keyframes float-card {
    0%, 100% { transform: translateY(-3px); }
    50% { transform: translateY(3px); }
}
@keyframes star-jiggle {
    0%, 100% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(-5deg) scale(1.1); }
    75% { transform: rotate(5deg) scale(1.1); }
}

.star-award-btn {
    font-family: 'Fredoka One', cursive;
    color: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 150ms ease-out;
    transform: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    font-size: 1.5rem; /* Larger base size */
    padding: 0.75rem 1rem;
    border-radius: 9999px; /* Pill shape */
    border-bottom: 4px solid rgba(0,0,0,0.2);
    position: relative; /* For animation pseudo-elements */
}
.star-award-btn .fa-star {
    color: #FFD700; /* Gold color for stars */
    text-shadow: 0 1px 1px rgba(0,0,0,0.3);
}
.star-award-btn:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    transform: scale(1.05);
}
.star-award-btn:hover .fa-star {
    animation: star-jiggle 0.5s ease-in-out;
}

.star-btn-1 { 
    background-image: linear-gradient(to right, var(--tw-gradient-stops));
    --tw-gradient-from: #22d3ee;
    --tw-gradient-to: #3b82f6;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
    border-bottom-color: #1D4ED8;
    --glow-color-1: #38BDF8;
    --glow-color-2: rgba(56, 189, 248, 0.5);
}
.star-btn-2 { 
    background-image: linear-gradient(to right, var(--tw-gradient-stops));
    --tw-gradient-from: #c084fc;
    --tw-gradient-to: #ec4899;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
    border-bottom-color: #BE185D;
    font-size: 1.6rem;
    --glow-color-1: #F472B6;
    --glow-color-2: rgba(244, 114, 182, 0.5);
}
.star-btn-3 { 
    background-image: linear-gradient(to right, var(--tw-gradient-stops));
    --tw-gradient-from: #fbbf24;
    --tw-gradient-to: #f97316;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
    border-bottom-color: #C2410C;
    font-size: 1.7rem;
    text-shadow: 0 2px 3px rgba(0,0,0,0.3);
    --glow-color-1: #FBBF24;
    --glow-color-2: rgba(251, 191, 36, 0.6);
}

/* --- V4.7: NEW STUDENT CLOUD CARD & ANIMATIONS --- */
.student-cloud-card {
    background-color: white;
    position: relative;
    padding: 1rem 1.5rem 1.5rem 1.5rem; /* Adjusted padding for avatar */
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    filter: drop-shadow(0 5px 8px rgba(0, 0, 0, 0.15));
    transform: translateZ(0);
    animation: float-card 6s ease-in-out infinite;
    padding-top: 40px; /* Make space for the overlapping avatar */
}

.student-avatar-cloud {
    position: absolute;
    top: -30px; /* Position it to overlap the top edge */
    left: 50%;
    transform: translateX(-50%);
    width: 70px;
    height: 70px;
    border-radius: 9999px;
    object-fit: cover;
    background-color: #e5e7eb;
    border: 4px solid white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 10;
    transition: all 0.3s ease-out;
}

.student-avatar-cloud-placeholder {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 70px;
    height: 70px;
    border-radius: 9999px;
    background-color: #d1d5db; /* gray-300 */
    border: 4px solid white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Fredoka One', cursive;
    font-size: 2rem;
    color: #4b5563; /* gray-600 */
    transition: all 0.3s ease-out;
}


@keyframes fade-out-down { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }
@keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.fade-out { animation: fade-out-down 0.3s ease-out forwards; }
.fade-in { animation: fade-in-up 0.3s ease-out forwards; }

.cloud-shape-1 { border-radius: 50% 60% 40% 70% / 60% 50% 70% 40%; }
.cloud-shape-2 { border-radius: 40% 70% 50% 60% / 70% 60% 40% 50%; }
.cloud-shape-3 { border-radius: 60% 50% 70% 40% / 50% 70% 50% 60%; }
.cloud-shape-4 { border-radius: 70% 40% 60% 50% / 60% 50% 70% 40%; }

.logo-select-btn:hover {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.4); 
    transform: scale(1.1);
    background-color: #f3f4f6;
}

@keyframes count-change {
    0% { transform: scale(1.0); }
    50% { transform: scale(1.2) rotate(5deg); background-color: #FCD34D; }
    100% { transform: scale(1.0) rotate(0deg); } 
}

.counter-animate {
    animation: count-change 0.5s ease-out;
}

@keyframes float-up-down {
    0%, 100% { transform: translateY(-5px); }
    50% { transform: translateY(5px); }
}
.floating-icon {
    animation: float-up-down 3s ease-in-out infinite;
}

@keyframes title-sparkle {
    0%, 100% { filter: brightness(1); text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    50% { filter: brightness(1.5) drop-shadow(0 0 8px #FBBF24); text-shadow: 0 2px 4px rgba(251, 191, 36, 0.5); }
}
.title-sparkle {
    animation: title-sparkle 2s ease-in-out infinite;
}

/* V5.3.4 HOME TAB REVAMP */
.game-card {
    background-color: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(4px);
    padding: 2rem 3rem;
    border-radius: 1.5rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-width: 4px;
    transition: all 300ms;
}

/* V5.4.4 REVAMP: Enlarged Home Buttons & V5.6 UPDATE: Smaller Buttons */
.about-tab-switcher {
    font-family: 'Fredoka One', cursive;
    font-size: 1.25rem; /* UPDATED */
    padding: 0.75rem 1.5rem; /* UPDATED */
    transition: all 200ms;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-bottom-width: 4px;
    border-color: rgba(107, 114, 128, 0.5);
    transform: none;
    border-radius: 9999px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
@media (min-width: 768px) {
    .about-tab-switcher {
        font-size: 1.5rem; /* UPDATED */
    }
}
.about-tab-switcher:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}
.about-tab-switcher:active {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    transform: translateY(2px) scale(0.98);
    border-bottom-width: 2px;
}

.about-content {
    animation: pop-in 0.4s ease-out;
}

@keyframes subtle-pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.03); opacity: 0.8; }
}
.login-bg-pulse {
    animation: subtle-pulse 5s ease-in-out infinite;
}

@keyframes float-star {
    0% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
    50% { transform: translate(20px, -20px) rotate(15deg); opacity: 0.9; }
    100% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
}
.floating-star {
    position: absolute;
    font-size: 3rem;
    animation: float-star 6s ease-in-out infinite alternate;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.prize-box {
    position: relative;
    overflow: hidden;
}
.prize-box::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.5) 50%, transparent 100%);
    transform: rotate(30deg);
    animation: prize-shimmer 5s infinite;
}
@keyframes prize-shimmer {
    0% { transform: translateX(-100%) rotate(30deg); }
    100% { transform: translateX(100%) rotate(30deg); }
}

/* --- Calendar Layout Fixes --- */
.calendar-day-cell {
     height: 130px; /* Fixed height for mobile */
     transition: background-color 0.2s ease-out;
     display: flex;       /* Use Flexbox to manage vertical stack */
     flex-direction: column; 
     overflow: hidden;    /* Cut off anything that flows outside the box */
}

@media (min-width: 768px) {
    .calendar-day-cell {
        height: 170px; /* Fixed height for desktop */
    }
}

.calendar-day-cell.future-day {
    cursor: pointer;
}
.calendar-day-cell.future-day:hover {
    background-color: #E0F2FE; /* sky-100 */
}
.calendar-day-cell.day-selected {
     background-color: #BAE6FD !important; /* sky-200 */
}
.today-date-highlight {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    background-color: #38bdf8;
    color: white;
    font-weight: bold;
}

.logbook-day-btn {
    cursor: pointer;
}
.logbook-day-btn:hover {
    background-color: #E0F2FE; /* sky-100 */
}
.delete-log-btn {
    color: #f87171;
    font-weight: bold;
    font-size: 1.125rem;
    margin-left: 0.5rem;
    padding: 0 0.25rem;
}
.delete-log-btn:hover {
    color: #dc2626;
}

/* v5.5.2: Note button for award logs */
.note-log-btn {
    color: #60a5fa;
    font-weight: bold;
    font-size: 1.125rem;
    margin-left: 0.5rem;
    padding: 0 0.25rem;
}
.note-log-btn:hover {
    color: #2563eb;
}

/* FIX #2: Move Undo button to LEFT to prevent overlap with Absence controls (Right) */
.post-award-undo-btn {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem; /* Changed from right: 0.75rem */
    width: 2rem;
    height: 2rem;
    background-color: #fee2e2;
    color: #dc2626;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    transition: all 200ms;
    transform: none;
    border-width: 2px;
    border-color: #fecaca;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    z-index: 20;
}
.post-award-undo-btn:hover {
    background-color: #fecaca;
    transform: scale(1.1);
}

.delete-event-btn {
    position: absolute;
    top: 0.25rem;
    right: 0.25rem;
    width: 1.25rem;
    height: 1.25rem;
    background-color: #fecaca;
    color: #b91c1c;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    opacity: 0.5;
    transition: all 150ms ease-out;
}
.delete-event-btn:hover {
    opacity: 1;
    background-color: #fca5a5;
}

/* Custom Minimal Scrollbar */
#calendar-grid .overflow-y-auto, #award-class-list, #adventure-log-feed, #story-history-content, #logbook-modal-content, #story-archive-list, #storybook-viewer-content, #scroll-student-roster, #attendance-chronicle-content, #trial-history-content, #schedule-manager-list, #avatar-maker-options-wrapper {
    scrollbar-width: thin; /* For Firefox */
    scrollbar-color: #A5B4FC transparent; /* For Firefox */
}
#calendar-grid .overflow-y-auto::-webkit-scrollbar, #award-class-list::-webkit-scrollbar, #adventure-log-feed::-webkit-scrollbar, #story-history-content::-webkit-scrollbar, #logbook-modal-content::-webkit-scrollbar, #story-archive-list::-webkit-scrollbar, #storybook-viewer-content::-webkit-scrollbar, #scroll-student-roster::-webkit-scrollbar, #attendance-chronicle-content::-webkit-scrollbar, #trial-history-content::-webkit-scrollbar, #schedule-manager-list::-webkit-scrollbar, #avatar-maker-options-wrapper::-webkit-scrollbar {
    width: 4px;
}
#calendar-grid .overflow-y-auto::-webkit-scrollbar-track, #award-class-list::-webkit-scrollbar-track, #adventure-log-feed::-webkit-scrollbar-track, #story-history-content::-webkit-scrollbar-track, #logbook-modal-content::-webkit-scrollbar-track, #story-archive-list::-webkit-scrollbar-track, #storybook-viewer-content::-webkit-scrollbar-track, #scroll-student-roster::-webkit-scrollbar-track, #attendance-chronicle-content::-webkit-scrollbar-track, #trial-history-content::-webkit-scrollbar-track, #schedule-manager-list::-webkit-scrollbar-track, #avatar-maker-options-wrapper::-webkit-scrollbar-track {
    background: transparent;
}
#calendar-grid .overflow-y-auto::-webkit-scrollbar-thumb, #award-class-list::-webkit-scrollbar-thumb, #adventure-log-feed::-webkit-scrollbar-thumb, #story-history-content::-webkit-scrollbar-thumb, #logbook-modal-content::-webkit-scrollbar-thumb, #story-archive-list::-webkit-scrollbar-thumb, #storybook-viewer-content::-webkit-scrollbar-thumb, #scroll-student-roster::-webkit-scrollbar-thumb, #attendance-chronicle-content::-webkit-scrollbar-thumb, #trial-history-content::-webkit-scrollbar-thumb, #schedule-manager-list::-webkit-scrollbar-thumb, #avatar-maker-options-wrapper::-webkit-scrollbar-thumb {
    background-color: #A5B4FC; /* indigo-300 */
    border-radius: 20px;
}
#calendar-grid .overflow-y-auto::-webkit-scrollbar-thumb:hover, #award-class-list::-webkit-scrollbar-thumb:hover, #adventure-log-feed::-webkit-scrollbar-thumb:hover, #story-history-content::-webkit-scrollbar-thumb:hover, #logbook-modal-content::-webkit-scrollbar-thumb:hover, #story-archive-list::-webkit-scrollbar-thumb:hover, #storybook-viewer-content::-webkit-scrollbar-thumb:hover, #scroll-student-roster::-webkit-scrollbar-thumb:hover, #attendance-chronicle-content::-webkit-scrollbar-thumb:hover, #trial-history-content::-webkit-scrollbar-thumb:hover, #schedule-manager-list::-webkit-scrollbar-thumb:hover, #avatar-maker-options-wrapper::-webkit-scrollbar-thumb:hover {
    background-color: #818CF8; /* indigo-400 */
}

#certificate-template {
    width: 800px;
    height: 600px;
    padding: 25px;
    border-width: 10px;
    border-style: solid;
    font-family: 'Georgia', serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.3s ease-in-out;
    box-sizing: border-box;
    position: relative;
}

/* --- V4.7.2: Quest Update Narrative & Award Dropdown Styles --- */
#narrative-text-container {
    font-size: 1.5rem;
    font-weight: 600;
    color: #374151;
    line-height: 1.6;
    padding: 1rem;
    background-color: #f3f4f6;
    border-radius: 0.5rem;
    min-height: 120px;
    overflow-wrap: break-word;
    white-space: normal;
    word-break: break-word;
}
@media (min-width: 768px) {
    #narrative-text-container {
        font-size: 1.875rem;
    }
}

#award-class-dropdown-panel {
    transform-origin: top;
    animation: pop-in 0.2s ease-out;
}

/* --- V5.0.0: QUEST MAP STYLES --- */
.quest-track-path {
    background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 40" width="40" height="20"><path fill="%23d1d5db" d="M 0 39 L 39 0 L 41 0 L 1 39 Z M 40 39 L 79 0 L 81 0 L 41 39 Z"></path></svg>');
    background-repeat: repeat-x;
}
.quest-track-progress {
    transition: width 1s ease-in-out;
}
.quest-track-avatar {
    transition: left 1s ease-in-out;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
    z-index: 10;
    transform: translateY(-50%) translateX(-50%);
}
.quest-track-avatar span {
    display: inline-block;
    transform: scale(1.1);
}

/* V5.4.3 FIX: Quest Map Avatar Hover Effects */
@keyframes quest-avatar-jiggle {
    0%, 100% { transform: rotate(0deg) scale(1.1); }
    25% { transform: rotate(-8deg) scale(1.15); }
    75% { transform: rotate(8deg) scale(1.15); }
}
@keyframes quest-avatar-spin-pop {
    0% { transform: rotate(0deg) scale(1.1); }
    50% { transform: rotate(180deg) scale(1.25); }
    100% { transform: rotate(360deg) scale(1.1); }
}
@keyframes quest-avatar-sparkle {
    0%, 100% { transform: scale(1.1); filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
    50% { transform: scale(1.3) rotate(5deg); filter: drop-shadow(0 0 10px #FBBF24) drop-shadow(0 0 5px #FFFFFF) drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
}
.quest-track-avatar {
    user-select: none;
}
.quest-track-avatar span {
    cursor: pointer;
}
.quest-track-avatar[data-progress-tier="low"] span:hover {
    animation: quest-avatar-jiggle 0.5s ease-in-out;
}
.quest-track-avatar[data-progress-tier="mid"] span:hover {
    animation: quest-avatar-spin-pop 0.6s ease-out;
}
.quest-track-avatar[data-progress-tier="high"] span:hover {
    animation: quest-avatar-sparkle 0.8s ease-in-out;
}

/* V5.4.1 MILESTONE ENHANCEMENT */
.milestone-marker {
    width: 3.5rem;
    height: 3.5rem;
    background-color: white;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.25rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 500ms;
    transform: translateY(-50%) translateX(-50%);
    z-index: 5;
    filter: grayscale(1);
    opacity: 0.5;
    position: relative; /* For tooltip positioning */
}
.milestone-marker.achieved {
    filter: grayscale(0) drop-shadow(0 0 10px #FBBF24) drop-shadow(0 0 5px #FFFFFF);
    opacity: 1;
    transform: translateY(-50%) translateX(-50%) scale(1.25);
}

/* --- V5.3.1: MILESTONE & QUEST MAP REVAMP --- */

.quest-card {
    position: relative;
}
.quest-card:hover {
    z-index: 10;
}

/* Quest Map Tooltips & Cursor */
.milestone-marker {
    cursor: pointer;
}
.milestone-tooltip {
    position: absolute;
    bottom: 140%; /* Position above the marker */
    left: 50%;
    transform: translateX(-50%) scale(0.8);
    background: linear-gradient(to bottom, #60A5FA, #3B82F6);
    color: white;
    padding: 8px 12px;
    border-radius: 12px;
    font-family: 'Fredoka One', cursive;
    text-align: center;
    width: 180px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    border: 2px solid white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    z-index: 20;
}
.milestone-marker:hover .milestone-tooltip {
    opacity: 1;
    transform: translateX(-50%) scale(1);
}
.milestone-tooltip::after { /* The little triangle */
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -8px;
    border-width: 8px;
    border-style: solid;
    border-color: #60A5FA transparent transparent transparent;
}
.tooltip-main-text {
    font-size: 1.1rem;
    line-height: 1.2;
}
.tooltip-sub-text {
    font-size: 0.75rem;
    opacity: 0.8;
    margin-top: 4px;
}

/* Enhanced Diamond Milestone Effects & V5.3.1 FIX */
.milestone-marker.is-diamond .milestone-tooltip {
    bottom: auto; /* Remove bottom positioning */
    top: 140%; /* Position below the marker */
}
.milestone-marker.is-diamond .milestone-tooltip::after {
    top: auto; /* Remove top positioning */
    bottom: 100%; /* Position on top of the tooltip body */
    border-color: transparent transparent #60A5FA transparent; /* Point up */
}

@keyframes diamond-achieved-glow {
    0% {
        filter: drop-shadow(0 0 8px #0CF) drop-shadow(0 0 12px #0CF) drop-shadow(0 0 20px #FFF);
        transform: translateY(-50%) translateX(-50%) scale(1.25);
    }
    50% {
        filter: drop-shadow(0 0 16px #0CF) drop-shadow(0 0 24px #0FF) drop-shadow(0 0 40px #FFF);
        transform: translateY(-50%) translateX(-50%) scale(1.35);
    }
    100% {
        filter: drop-shadow(0 0 8px #0CF) drop-shadow(0 0 12px #0CF) drop-shadow(0 0 20px #FFF);
        transform: translateY(-50%) translateX(-50%) scale(1.25);
    }
}
.milestone-marker.is-diamond.achieved {
    animation: diamond-achieved-glow 2s ease-in-out infinite;
}
.milestone-marker.is-diamond:hover .milestone-tooltip {
    background: linear-gradient(135deg, #2dd4bf, #38bdf8);
}
.milestone-marker.is-diamond:hover .milestone-tooltip::after {
    border-bottom-color: #2dd4bf; /* Match gradient */
}


/* New Award Flow Styles */
.reason-selector .reason-btn {
    transition: all 0.2s ease-out;
}
.reason-selector .reason-btn.active {
    transform: scale(1.1);
}
.reason-selector .reason-btn.active i {
    color: white;
}
.reason-selector .reason-btn[data-reason="teamwork"].active { background-color: #8b5cf6; }
.reason-selector .reason-btn[data-reason="creativity"].active { background-color: #ec4899; }
.reason-selector .reason-btn[data-reason="respect"].active { background-color: #22c55e; }
.reason-selector .reason-btn[data-reason="focus"].active { background-color: #eab308; }

.star-selector-container {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out, margin-top 0.3s ease-out;
    margin-top: 0;
}
.star-selector-container.visible {
    max-height: 100px;
    opacity: 1;
    margin-top: 0.75rem;
}

/* Reason Button Animation */
@keyframes spark-burst {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
}
.animate-reason-select {
    animation: spark-burst 0.4s ease-out;
    position: relative;
}
.animate-reason-select::before, .animate-reason-select::after {
    content: '✨';
    position: absolute;
    top: 50%;
    left: 50%;
    opacity: 0;
    animation: spark-fly 0.5s ease-out;
    font-size: 1.5rem;
    z-index: 10;
}
.animate-reason-select::after {
    content: '⭐';
    animation-delay: 0.1s;
}
@keyframes spark-fly {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
    100% { transform: translate(var(--x, -60px), var(--y, -60px)) scale(1); opacity: 0; }
}

/* --- V5.3.2: REVAMPED STAR BUTTON EFFECTS --- */
.award-particle {
    position: fixed;
    border-radius: 50%;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    animation: particle-fly 1s ease-out forwards;
    transform: translate(-50%, -50%); /* Center the particle on its coordinates */
}

@keyframes particle-fly {
    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
    100% { transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0); opacity: 0; }
}

.screen-flash {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: var(--flash-color);
    opacity: 0;
    z-index: 999;
    pointer-events: none;
    animation: screen-flash-anim 0.6s ease-out;
}

@keyframes screen-flash-anim {
    0% { opacity: 0; }
    20% { opacity: 0.3; }
    100% { opacity: 0; }
}

.shockwave {
    position: fixed;
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0);
    border: 3px solid var(--shockwave-color);
    opacity: 1;
    z-index: 998;
    pointer-events: none;
    animation: shockwave-anim 0.7s ease-out;
}

@keyframes shockwave-anim {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 1; width: 0px; height: 0px; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 0; width: 400px; height: 400px; }
}

/* --- NEW: STUDENT LEADERBOARD CARD REVAMP --- */
@keyframes float-leaderboard-card {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
}
.student-leaderboard-card {
    animation: float-leaderboard-card 6s ease-in-out infinite;
}

/* --- NEW: Absence & Welcome Back Feature Styles (FIXED) --- */
.student-cloud-card .card-content-wrapper {
    transition: all 0.3s ease-out;
}
.student-cloud-card.is-absent .card-content-wrapper,
.student-cloud-card.is-absent .student-avatar-cloud,
.student-cloud-card.is-absent .student-avatar-cloud-placeholder {
    filter: grayscale(80%);
    opacity: 0.6;
}
.student-cloud-card.is-absent .reason-selector,
.student-cloud-card.is-absent .star-selector-container {
    pointer-events: none;
}

.absence-controls {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
    z-index: 20; /* Ensure buttons are on top of avatar */
}
.absence-btn {
    width: 2.5rem;
    height: 2.5rem;
    background-color: #e5e7eb;
    color: #4b5563;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    transition: all 200ms;
    transform: none;
}
.absence-btn:hover {
    background-color: #d1d5db;
    transform: scale(1.1);
}
@keyframes rainbow-glow {
    0%, 100% {
        background-position: 0% 50%;
        box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
    }
    50% {
        background-position: 100% 50%;
        box-shadow: 0 0 16px rgba(251, 191, 36, 0.7);
    }
}
.welcome-back-btn {
    width: 2.5rem;
    height: 2.5rem;
    color: white;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    transition: transform 150ms;
    background: linear-gradient(90deg, #f87171, #fb923c, #fbbf24, #4ade80, #22d3ee, #60a5fa, #c084fc);
    background-size: 400% 400%;
    animation: rainbow-glow 4s ease-in-out infinite;
}
.welcome-back-btn:hover {
    transform: scale(1.1);
}
.welcome-back-btn:active {
    transform: scale(0.9);
}

/* --- ADVENTURE LOG DIARY STYLE (WITH ANIMATION FIX) --- */
.diary-page {
    background: #FFFAF0; /* FloralWhite, like old paper */
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 8px 15px rgba(0,0,0,0.1), 0 0 0 1px #FDF5E6, 0 2px 4px rgba(0,0,0,0.1);
    border-left: 3px solid #FFDAB9; /* PeachPuff */
    position: relative;
    /* FIX 2: This is the crucial missing piece for the animation */
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease-out;
}
.diary-page.empty {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    border-style: dashed;
    border-color: #ccc;
    background: #f9f9f9;
}
.diary-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 2px dashed #FFDAB9;
    padding-bottom: 0.75rem;
    margin-bottom: 1rem;
}
.diary-date {
    font-family: 'Lora', serif;
    font-style: italic;
    font-size: 1.25rem;
    color: #8B4513; /* SaddleBrown */
}
.diary-hero {
    background-color: #fef3c7;
    color: #92400e;
    font-size: 0.875rem;
    font-weight: bold;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
}
.diary-body {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}
@media (min-width: 640px) {
    .diary-body {
        grid-template-columns: 200px 1fr;
    }
}
.diary-image-container {
    width: 100%;
    aspect-ratio: 1/1;
    border: 5px solid #FDF5E6; /* Linen */
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 5px;
    background-color: white;
}
.diary-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.diary-text-content {
    display: flex;
    flex-direction: column;
}
.diary-text {
    font-family: 'Lora', serif;
    font-size: 1.1rem;
    line-height: 1.7;
    color: #374151;
    flex-grow: 1;
}
.diary-note {
    background-color: #f0f9ff;
    border-left: 3px solid #60a5fa;
    padding: 0.75rem;
    margin-top: 1rem;
    font-style: italic;
}
.diary-note p { color: #1e40af; }
.diary-note-author { color: #1d4ed8; font-size: 0.75rem; font-weight: 600; margin-top: 0.25rem; display: block; }
.diary-footer {
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}
.diary-keywords {
    font-size: 0.875rem;
    color: #6b7280;
}
.diary-keyword {
    display: inline-block;
    background-color: #f3f4f6;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    margin-right: 0.5rem;
    margin-top: 0.25rem;
}

/* --- NEW: Quest Map Avatar Tooltip --- */
.quest-track-avatar .avatar-tooltip {
    position: absolute;
    bottom: 130%; 
    left: 50%;
    transform: translateX(-50%) scale(0.8);
    background: #374151;
    color: white;
    padding: 6px 10px;
    border-radius: 8px;
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    text-align: center;
    width: max-content;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 20;
}
.quest-track-avatar span:hover + .avatar-tooltip {
    opacity: 1;
    transform: translateX(-50%) scale(1);
}

/* --- NEW: 100% Quest Completion Celebration --- */
@keyframes quest-complete-glow {
    0%, 100% {
        filter: drop-shadow(0 0 6px #FBBF24) drop-shadow(0 0 3px #FFFFFF);
        transform: scale(1.2);
    }
    50% {
        filter: drop-shadow(0 0 12px #FBBF24) drop-shadow(0 0 6px #FFFFFF);
        transform: scale(1.3);
    }
}
.quest-track-avatar.quest-complete span {
    animation: quest-complete-glow 2s ease-in-out infinite;
    cursor: default;
}
.quest-track-avatar.quest-complete .avatar-tooltip {
    display: none;
}

/* V5.5.0: Story Weaver Revamp */
#story-weavers-main-content {
    background: linear-gradient(to bottom, #f0f9ff, #e0f2fe);
    border-radius: 1.5rem;
    padding: 1rem;
    border: 2px solid #a5f3fc;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    transition: flex-grow 0.4s ease-in-out;
}
#story-weavers-image-container {
    width: 100%;
    aspect-ratio: 1/1;
    background-color: #e0f2fe;
    border-radius: 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px dashed #93c5fd;
    overflow: hidden;
}
#story-weavers-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
#story-weavers-text {
    font-family: 'Georgia', serif;
    font-size: 1.25rem;
    color: #1e3a8a;
    min-height: 80px;
}
#story-history-content .story-history-card, #storybook-viewer-content .story-history-card {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background-color: white;
    border-radius: 1rem;
    border: 1px solid #e5e7eb;
}
#story-history-content .story-history-card img, #storybook-viewer-content .story-history-card img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 0.75rem;
    flex-shrink: 0;
}
#story-history-content .story-history-card .text-content, #storybook-viewer-content .story-history-card .text-content {
    display: flex;
    flex-direction: column;
}

/* v5.5.4 Storybook Archive Styles */
.completed-storybook-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background-color: white;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-left-width: 8px;
    transition: all 200ms;
}
.completed-storybook-item:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    transform: translateY(-0.25rem);
}
.audio-controls button.playing i:before {
    content: "\f04c"; /* Font Awesome pause icon */
}

/* Loading Screen Animation */
@keyframes fall {
    0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(200px) rotate(360deg); opacity: 0; }
}
.star {
    position: absolute;
    font-size: 2rem;
    color: #FBBF24;
    animation: fall 2s linear infinite;
}

/* --- NEW in v6.0.0: Scholar's Scroll & Starfall Styles --- */

/* Starfall Modal Background */
@keyframes starfall-swirl {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
.starfall-bg {
    background: radial-gradient(ellipse at center, rgba(29,78,216,0.5) 0%, rgba(30,58,138,0.8) 40%, rgba(17,24,39,1) 100%);
    animation: starfall-swirl 20s linear infinite;
}
/* Starfall Modal Icon */
@keyframes starfall-icon-pulse {
    0%, 100% { 
        transform: scale(1);
        filter: drop-shadow(0 0 10px #FBBF24) drop-shadow(0 0 20px #FFF);
    }
    50% { 
        transform: scale(1.1);
        filter: drop-shadow(0 0 20px #FBBF24) drop-shadow(0 0 40px #FFF);
    }
}
.starfall-icon-animate {
    animation: starfall-icon-pulse 2.5s ease-in-out infinite;
}

/* Scholar's Scroll Dashboard Cards */
.scroll-stat-card {
    background-color: #fffbeb; /* amber-50 */
    border-left-width: 8px;
    border-color: #f59e0b; /* amber-600 */
    padding: 1rem;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    display: flex; /* FIX #3 */
    flex-direction: column; /* FIX #3 */
    justify-content: space-between; /* FIX #3 */
    min-height: 120px; /* FIX #3 */
}
/* FIX #3: Allow scholar names to wrap */
.scroll-stat-card .font-title {
    white-space: normal;
    word-break: break-word;
    flex-grow: 1;
}

.scroll-student-row:hover {
    background-color: #f9fafb; /* gray-50 */
}

/* *** NEW: Style for optgroup labels in select dropdowns *** */
optgroup {
    font-weight: bold;
    font-style: italic;
    color: #581c87; /* purple-900 */
    background-color: #f3f4f6; /* gray-100 */
    padding: 4px;
}

/* --- NEW IN v6.1: Attendance & Overview Styles --- */

/* Attendance Chronicle */
#attendance-chronicle-content .date-header {
    position: sticky;
    top: -1px;
    background-color: #f3f4f6; /* gray-100 */
    z-index: 10;
}
.attendance-status {
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 9999px;
    display: inline-block;
}
.status-present {
    background-color: #22c55e; /* green-500 */
    box-shadow: 0 0 5px #22c55e;
}
.status-absent {
    background-color: #ef4444; /* red-500 */
    box-shadow: 0 0 5px #ef4444;
}

/* --- NEW IN v6.1.2: Revamped Attendance Chronicle Modal --- */

#attendance-chronicle-content {
    overflow: auto;
}

#attendance-chronicle-content table {
    min-width: 600px; 
}

#attendance-chronicle-content th,
#attendance-chronicle-content td {
    padding: 0.75rem 0.5rem;
    border: 1px solid #e5e7eb;
    text-align: center;
    vertical-align: middle;
}

#attendance-chronicle-content th {
    background-color: #f9fafb;
    font-size: 0.875rem;
    font-weight: 600;
    color: #4b5563;
}

#attendance-chronicle-content th:first-child,
#attendance-chronicle-content td:first-child {
    text-align: left;
    position: sticky;
    left: 0;
    background-color: #f9fafb;
    z-index: 20;
}

#attendance-chronicle-content td:first-child {
    background-color: #ffffff;
    font-weight: 500;
}

#attendance-chronicle-content tbody tr:hover td,
#attendance-chronicle-content tbody tr:hover td:first-child {
    background-color: #f3f4f6;
}

.attendance-status-btn {
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 9999px;
    display: inline-block;
    cursor: pointer;
    transition: all 150ms ease-out;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1), inset 0 1px 2px rgba(255,255,255,0.5);
    border: 2px solid transparent;
}

.attendance-status-btn:hover {
    transform: scale(1.2);
    border-color: #9ca3af;
}

.attendance-status-btn.status-present {
    background-color: #22c55e;
    box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
}

.attendance-status-btn.status-absent {
    background-color: #ef4444;
    box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
}

/* --- NEW: Trial History Modal Styles (FIX #3) --- */
#trial-history-modal {
    z-index: 71; /* Higher than edit modal */
}
#log-trial-modal {
    z-index: 72; /* Higher than history modal */
}

#trial-history-view-toggle .toggle-btn {
    font-family: 'Fredoka One', cursive;
    padding: 0.5rem 1.5rem;
    border-radius: 9999px;
    font-size: 1.125rem;
    color: #9A3412; /* amber-800 */
    transition: all 200ms ease-out;
    cursor: pointer;
}
#trial-history-view-toggle .toggle-btn.active-toggle {
    background-color: #F59E0B; /* amber-500 */
    color: white;
    box-shadow: 0 4px 10px rgba(245, 158, 11, 0.4);
    transform: scale(1.05);
}

.trial-history-item {
    background-color: white;
    padding: 1rem;
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border-left-width: 6px;
    border-color: #FCD34D; /* amber-300 */
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 200ms ease-out;
}
.trial-history-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-color: #FBBF24; /* amber-400 */
}

.delete-trial-btn, .edit-trial-btn {
    opacity: 0.5;
}
.trial-history-item:hover .delete-trial-btn, .trial-history-item:hover .edit-trial-btn {
    opacity: 1;
}
.edit-trial-btn { background-color: #dbeafe; color: #1e40af; }

details.month-group {
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    overflow: hidden;
}
details.month-group summary {
    background-color: #f9fafb;
    border-bottom: 1px solid #e5e7eb;
}
details.month-group[open] summary {
    border-bottom-color: transparent;
}

/* FIX #1: Trial History Date Grouping */
.date-group-header {
    font-weight: 600;
    color: #4b5563; /* gray-600 */
    padding: 0.5rem;
    background-color: #f3f4f6; /* gray-100 */
    border-radius: 0.5rem;
    margin-top: 0.5rem;
}

/* --- NEW IN v6.2.2: Overview Modal Styles --- */
.overview-tab-btn {
    transition: all 150ms ease-in-out;
}

.overview-stat-card {
    background-color: #faf5ff; /* purple-50 */
    border-left-width: 6px;
    border-color: #a855f7; /* purple-600 */
    padding: 1rem;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* --- NEW IN v6.9.1: Avatar Maker & Display Styles --- */

/* Avatar Display (used in various places) */
.student-avatar {
    width: 40px;
    height: 40px;
    border-radius: 9999px;
    object-fit: cover;
    background-color: #e5e7eb; /* gray-200 */
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.student-avatar.large-avatar {
    width: 48px;
    height: 48px;
}

/* Button in Student Management List */
.avatar-maker-btn, .move-student-btn {
    background-color: #dbeafe; /* blue-100 */
    color: #1e40af; /* blue-800 */
}
.avatar-maker-btn:hover, .move-student-btn:hover {
    background-color: #bfdbfe; /* blue-200 */
}
.move-student-btn { background-color: #fef9c3; color: #713f12; }
.move-student-btn:hover { background-color: #fef08a; }

/* Avatar Maker Modal */
.avatar-maker-option-pool {
    background-color: #f3f4f6; /* gray-100 */
    border-radius: 1rem;
    padding: 1rem;
    border: 2px solid #e5e7eb; /* gray-200 */
}
.avatar-maker-option-btn {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-weight: 600;
    cursor: pointer;
    transition: all 150ms ease-out;
    border: 2px solid transparent;
    background-color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.avatar-maker-option-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.avatar-maker-option-btn.selected {
    transform: scale(1.05);
    border-color: #3b82f6; /* blue-500 */
    background-color: #dbeafe; /* blue-100 */
    color: #1e40af; /* blue-800 */
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
}

#avatar-display-area {
    width: 256px;
    height: 256px;
    background-color: #e5e7eb; /* gray-200 */
    border-radius: 1.5rem;
    border: 4px dashed #9ca3af; /* gray-400 */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}
#avatar-display-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* --- CEREMONY FEATURE STYLES --- */

/* Pulsing Nav Button */
@keyframes ceremony-pulse {
    0%, 100% {
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 2px 4px rgba(0,0,0,0.4);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 30px #FBBF24, 0 0 15px #FFFFFF, 0 4px 8px rgba(0,0,0,0.4);
        transform: scale(1.05);
    }
}
.ceremony-ready-pulse {
    animation: ceremony-pulse 2s ease-in-out infinite;
}

/* Day Planner Modal Tabs */
.day-planner-tab-btn {
    transition: all 150ms ease-in-out;
}

/* Ceremony Reveal Cards */
@keyframes slide-in-from-bottom {
    from { transform: translateY(100px) scale(0.9); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}
@keyframes finalist-shimmer {
    0% { border-color: rgba(255, 255, 255, 0.5); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
    50% { border-color: rgba(255, 255, 255, 1); box-shadow: 0 0 40px rgba(255,255,255,0.7); }
    100% { border-color: rgba(255, 255, 255, 0.5); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
}
@keyframes winner-glow {
    0% { transform: scale(1.1); box-shadow: 0 0 30px #FBBF24, 0 0 15px #fff; }
    50% { transform: scale(1.15); box-shadow: 0 0 60px #FCD34D, 0 0 30px #fff; }
    100% { transform: scale(1.1); box-shadow: 0 0 30px #FBBF24, 0 0 15px #fff; }
}

/* --- CEREMONY VISUAL REVAMP (Bubbly & Bright) --- */

.ceremony-card {
    animation: slide-in-from-bottom 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; /* Bouncy entry */
    background: white;
    border: 4px solid #e5e7eb; /* Light Gray default */
    width: 340px; /* Slightly wider */
    padding: 2rem;
    border-radius: 2rem; /* Very rounded */
    text-align: center;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    transition: all 0.5s ease-in-out;
    position: relative;
    overflow: hidden;
}

/* Rank Specific Styles */
.ceremony-card.podium-1 { 
    border-color: #fbbf24; /* Amber-400 */
    background: linear-gradient(to bottom, #fffbeb, #fff7ed);
    transform: scale(1.15); 
    z-index: 20; 
    box-shadow: 0 0 40px rgba(251, 191, 36, 0.6);
}
.ceremony-card.podium-2 { 
    border-color: #94a3b8; /* Slate-400 */
    background: linear-gradient(to bottom, #f8fafc, #f1f5f9);
    z-index: 10;
}
.ceremony-card.podium-3 { 
    border-color: #fdba74; /* Orange-300 */
    background: linear-gradient(to bottom, #fff7ed, #ffedd5);
    z-index: 5;
}

/* Finalist / Mystery Card */
.ceremony-card.finalist {
    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); /* Indigo to Violet */
    border-color: #c4b5fd;
    color: white;
    transform: scale(1);
    box-shadow: 0 0 30px rgba(124, 58, 237, 0.5);
}
.ceremony-card.finalist h3 { color: white; }

/* Animations */
@keyframes slide-in-from-bottom {
    from { transform: translateY(100px) scale(0.8); opacity: 0; }
    to { transform: translateY(0) scale(1); opacity: 1; }
}

@keyframes winner-bounce {
    0%, 100% { transform: scale(1.15) translateY(0); }
    50% { transform: scale(1.2) translateY(-10px); }
}

.ceremony-card.podium-1 {
    animation: slide-in-from-bottom 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards, winner-bounce 2s ease-in-out infinite 1s;
}

/* Confetti Animation */
#ceremony-reveal-area.confetti-active::before {
    content: '🎉';
    position: absolute;
    top: -10%; left: 10%;
    font-size: 2rem;
    animation: confetti-fall 5s linear infinite;
    animation-delay: 0s;
}
#ceremony-reveal-area.confetti-active::after {
    content: '🎊';
    position: absolute;
    top: -10%; left: 80%;
    font-size: 3rem;
    animation: confetti-fall 5s linear infinite;
    animation-delay: -2.5s;
}

@keyframes confetti-fall {
    from { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
    to { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

.ceremony-card {
    transition: all 0.5s ease-in-out;
}

.ceremony-card.podium-1 { 
    border-color: #FFD700; 
    transform: scale(1.1); 
    z-index: 10; 
    animation: winner-glow 1.5s ease-in-out infinite, slide-in-from-bottom 0.5s ease-out forwards; 
}

/* --- FINAL: Smooth Tab Change Animations --- */
main {
    position: relative;
}

@keyframes tab-fade-in {
    from { opacity: 0; }
    to   { opacity: 1; }
}

@keyframes tab-fade-out {
    from { opacity: 1; }
    to   { opacity: 0; }
}

.app-tab.tab-animate-in {
    animation: tab-fade-in 350ms ease-out forwards;
}

.app-tab.tab-animate-out {
    position: absolute; 
    top: 1.5rem;
    left: 1.5rem;
    right: 1.5rem;
    width: auto;
    animation: tab-fade-out 350ms ease-in forwards;
}

@media (max-width: 767px) {
    .app-tab.tab-animate-out {
        top: 1rem;
        left: 1rem;
        right: 1rem;
    }
}

/* FIX 3: Added animations for login/app screen transition */
@keyframes auth-fade-out {
    from { transform: scale(1); opacity: 1; }
    to { transform: scale(1.05); opacity: 0; }
}
.auth-screen-out {
    animation: auth-fade-out 0.5s ease-in forwards;
}

@keyframes app-fade-in {
    from { transform: scale(0.95); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}
.app-screen-in {
    animation: app-fade-in 0.5s ease-out forwards;
}


/* --- FIX #6: Avatar Enlargement Styles --- */
.enlargeable-avatar {
    cursor: pointer;
    transition: transform 0.2s ease-out;
}

/* FIX #5: Specific avatar hover effects */
.student-leaderboard-card .enlargeable-avatar:hover, #student-list .enlargeable-avatar:hover, #scroll-performance-chart .enlargeable-avatar:hover {
    transform: scale(1.1);
}

@keyframes cloud-avatar-wiggle {
    0%, 100% { transform: translateX(-50%) rotate(-2deg); }
    50% { transform: translateX(-50%) rotate(2deg); }
}
.student-cloud-card .enlargeable-avatar:hover {
    animation: cloud-avatar-wiggle 0.4s ease-in-out;
}


.enlarged-avatar-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s ease-out;
    cursor: pointer;
}

.enlarged-avatar-image {
    position: fixed;
    border-radius: 9999px;
    border: 6px solid white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 101;
    cursor: default;
}

/* --- FIX #10: Smooth Resizing for Idea Forge --- */
#reward-ideas-tab .grid {
    align-items: start;
    transition: align-items 0.4s ease-in-out;
}
#reward-ideas-tab .grid.story-weavers-active {
    display: flex;
    flex-direction: column;
}
@media (min-width: 768px) {
    #reward-ideas-tab .grid.story-weavers-active {
        flex-direction: row;
        align-items: stretch;
    }
}
#reward-ideas-tab .grid > div {
    transition: flex-grow 0.4s ease-in-out;
    width: 100%;
}
@media (min-width: 768px) {
    #reward-ideas-tab .grid > div {
        width: auto;
    }
}


#reward-ideas-tab .grid.story-weavers-active > div:last-child {
    flex-grow: 1;
}

/* --- FIX #2: Scholar's Scroll Performance Chart Styles --- */
.performance-chart-container {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}
.chart-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}
.chart-row .student-avatar {
    flex-shrink: 0;
}
.chart-label {
    width: 180px; /* MODIFIED: Increased from 120px to give names more space */
    font-weight: 600;
    color: #4b5563;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 0;
}
.chart-bar-wrapper {
    flex-grow: 1;
    background-color: #e5e7eb;
    border-radius: 9999px;
    height: 2rem;
    padding: 0.25rem;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    position: relative; /* Added for tooltip positioning */
}
@keyframes grow-bar {
    from { width: 0%; }
}
.chart-bar {
    height: 100%;
    border-radius: 9999px;
    width: 0; /* Initial width for animation */
    animation: grow-bar 1s ease-out forwards;
    transition: background-color 0.5s;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 0.75rem;
    color: white;
    font-weight: bold;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}
.chart-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent);
    background-size: 20px 20px;
    opacity: 0.5;
}
/* Bar colors based on score */
.chart-bar[data-score-tier="high"] {
    background-image: linear-gradient(to right, #22c55e, #86efac);
}
.chart-bar[data-score-tier="mid"] {
    background-image: linear-gradient(to right, #eab308, #fde047);
}
.chart-bar[data-score-tier="low"] {
    background-image: linear-gradient(to right, #ef4444, #f87171);
}

/* --- NEW: Hero Stats Modal Styles --- */
@keyframes hero-avatar-float {
    0%, 100% { transform: translateY(-4px) rotate(-1deg); }
    50% { transform: translateY(4px) rotate(1deg); }
}

#hero-stats-avatar-container #hero-stats-avatar {
    animation: hero-avatar-float 6s ease-in-out infinite;
}

#hero-stats-avatar img, #hero-stats-avatar div {
    width: 100%;
    height: 100%;
    border-radius: 9999px;
    object-fit: cover;
}

.hero-stat-item {
    background-color: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}
.hero-stat-item .icon {
    font-size: 1.75rem;
    width: 2.5rem;
    text-align: center;
}
.hero-stat-item .text .title {
    font-size: 0.875rem;
    font-weight: bold;
    color: #d8b4fe; /* purple-300 */
    text-transform: uppercase;
}
.hero-stat-item .text .value {
    font-size: 1.125rem;
    color: white;
    font-weight: 500;
}

/* --- NEW: CSS Rule for Hero Stats Modal Layout --- */
#hero-stats-chart-container {
    position: relative; /* Required by Chart.js for responsiveness */
    min-height: 200px;
}

/* --- NEW IN v6.4: Bulk Trial Log Styles --- */
.bulk-log-item {
    transition: all 0.2s ease-in-out;
    border: 2px solid transparent;
}
.bulk-log-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}
.bulk-log-item.absent {
    background-color: #F3F4F6;
    border-style: dashed;
    border-color: #9CA3AF;
}
.bulk-log-item.absent .student-avatar {
    filter: grayscale(100%);
    opacity: 0.6;
}
.bulk-log-item.absent .grade-input-wrapper {
    opacity: 0.4;
    pointer-events: none;
}

.toggle-absent-btn {
    transition: all 0.2s;
}
.toggle-absent-btn.is-absent {
    background-color: #EF4444;
    color: white;
}

.bulk-grade-input {
    transition: border-color 0.2s;
}
.bulk-grade-input:focus {
    border-color: #f59e0b; /* amber-500 */
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
}

/* Attendance Column Delete Button */
.attendance-header-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}
.delete-column-btn {
    font-size: 0.65rem;
    color: #9ca3af;
    cursor: pointer;
    padding: 2px 6px;
    border-radius: 4px;
    transition: all 0.2s;
    background-color: #f3f4f6;
}
.delete-column-btn:hover {
    color: #ef4444; /* Red */
    background-color: #fee2e2;
}

/* --- HOLIDAY CALENDAR OVERLAYS --- */

/* Base Holiday Cell */
.calendar-holiday-cell {
    position: relative;
    overflow: hidden;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

/* Christmas Theme (Candy Cane + Snow) */
.holiday-theme-christmas {
    background: repeating-linear-gradient(
        45deg,
        #FEF2F2,
        #FEF2F2 10px,
        #FEE2E2 10px,
        #FEE2E2 20px
    );
    border-color: #FECACA;
}
.holiday-theme-christmas::before {
    content: '❄️';
    position: absolute;
    font-size: 1.5rem;
    top: -10px;
    right: -5px;
    opacity: 0.6;
    animation: float-snow 3s ease-in-out infinite;
}
@keyframes float-snow {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(5px) rotate(20deg); }
}

/* Easter Theme (Spring + Eggs) */
.holiday-theme-easter {
    background: linear-gradient(to bottom right, #F0FDF4, #FEFCE8); /* Green to Yellow */
    border-color: #BBF7D0;
}
.holiday-theme-easter::after {
    content: '🥚';
    position: absolute;
    bottom: 2px;
    right: 2px;
    font-size: 1.2rem;
    opacity: 0.7;
    transform: rotate(15deg);
}
.holiday-theme-easter::before {
    content: '🌸';
    position: absolute;
    top: 2px;
    left: 2px;
    font-size: 1rem;
    opacity: 0.6;
}

/* Generic Holiday */
.holiday-theme-generic {
    background-color: #F3F4F6;
    background-image: radial-gradient(#E5E7EB 1px, transparent 1px);
    background-size: 10px 10px;
}

/* Text Overlay */
.holiday-label {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    color: rgba(0,0,0,0.1);
    pointer-events: none;
    white-space: nowrap;
    z-index: 0;
}
.holiday-theme-christmas .holiday-label { color: rgba(220, 38, 38, 0.15); } /* Red tint */
.holiday-theme-easter .holiday-label { color: rgba(101, 163, 13, 0.15); } /* Green tint */

/* --- NEW: Missing / Makeup Work Styles --- */
.makeup-alert-container {
    background-color: #fff7ed; /* orange-50 */
    border: 2px dashed #f97316; /* orange-500 */
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 1.5rem;
}

.makeup-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: white;
    padding: 0.75rem;
    border-radius: 0.5rem;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    border-left: 4px solid #f97316;
    margin-bottom: 0.5rem;
}

.makeup-log-btn {
    background-color: #ffedd5;
    color: #9a3412;
    font-weight: bold;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    transition: all 0.2s;
}
.makeup-log-btn:hover {
    background-color: #fdba74;
    color: #7c2d12;
}

/* --- PROJECTOR MODE STYLES --- */
body.projector-mode .app-tab {
    padding: 0;
    max-width: 100vw;
    /* Add padding bottom so content isn't covered by the floating nav */
    padding-bottom: 80px; 
}

/* 1. Hide Admin Controls (Everything BUT the nav bar) */
body.projector-mode .delete-log-btn,
body.projector-mode .note-log-btn,
body.projector-mode .edit-class-btn,
body.projector-mode .delete-class-btn,
body.projector-mode .manage-students-btn,
body.projector-mode .report-class-btn, 
body.projector-mode #add-student-form,
body.projector-mode #award-class-dropdown-btn,
body.projector-mode #log-adventure-btn,
body.projector-mode #quest-assignment-btn,
body.projector-mode #attendance-chronicle-btn,
body.projector-mode #gemini-idea-btn,
body.projector-mode .absence-controls,
body.projector-mode .post-award-undo-btn,
body.projector-mode .edit-trial-btn,
body.projector-mode .delete-trial-btn,
body.projector-mode #log-trial-btn,
body.projector-mode #view-trial-history-btn {
    display: none !important;
}

/* 2. The Collapsible Navigation Bar */
body.projector-mode #bottom-nav-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    z-index: 100;
    
    /* Default State: Hidden (Transparent and pushed down) */
    opacity: 0;
    transform: translateY(30px);
    
    /* Smooth Transition */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Visuals for the floating bar */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(8px);
    box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    border-top: 4px solid #6366f1; /* Indigo accent line */
    padding: 10px;
}

/* 3. The Hover Trigger: Show it when mouse is near bottom */
body.projector-mode #bottom-nav-bar:hover,
body.projector-mode #bottom-nav-bar:focus-within {
    opacity: 1;
    transform: translateY(0);
}

/* 4. Invisible Hit-Area (Makes it easier to trigger the hover) */
body.projector-mode #bottom-nav-bar::before {
    content: '';
    position: absolute;
    top: -20px; /* Extends the hover zone 20px upwards */
    left: 0;
    width: 100%;
    height: 20px;
    background: transparent;
}

/* 5. Make visuals bigger for the big screen */
body.projector-mode .student-cloud-card {
    transform: scale(1.15);
    margin: 25px;
}

body.projector-mode #class-leaderboard-list .quest-card,
body.projector-mode #student-leaderboard-list .student-leaderboard-card {
    border-width: 6px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* --- BOUNTY BOARD STYLES --- */
.bounty-card {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border: 3px solid #f59e0b;
    border-radius: 1rem;
    padding: 1rem 1.5rem;
    position: relative;
    box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.2), 0 2px 4px -1px rgba(245, 158, 11, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    overflow: hidden;
    animation: slide-in-from-bottom 0.5s ease-out;
}

.bounty-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 4px;
    background: linear-gradient(90deg, #fcd34d, #f59e0b, #b45309, #f59e0b, #fcd34d);
    background-size: 200% 100%;
    animation: shimmer 2s infinite linear;
}

@keyframes shimmer {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
}

.bounty-timer {
    font-variant-numeric: tabular-nums;
    font-family: 'Fredoka One', cursive;
}

.bounty-card.expired {
    background: #fee2e2;
    border-color: #ef4444;
    filter: grayscale(0.8);
}

.bounty-card.completed {
    background: #ecfccb;
    border-color: #84cc16;
}

/* Projector Mode Adjustments for Bounties */
body.projector-mode .bounty-card {
    transform: scale(1.2);
    margin-bottom: 2rem;
    box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
}
body.projector-mode .bounty-actions {
    display: none; /* Hide 'Delete'/'Claim' buttons in projector mode */
}

/* --- SHOP STYLES --- */
.shop-item-card {
    background: rgba(30, 27, 75, 0.8); /* indigo-950 */
    border: 2px solid #4f46e5; /* indigo-600 */
    border-radius: 1rem;
    overflow: hidden;
    position: relative;
    transition: all 0.3s ease;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
}

.shop-item-card:hover {
    transform: translateY(-5px);
    border-color: #fbbf24; /* amber-400 */
    box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
}

.shop-item-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-bottom: 2px solid #4f46e5;
}

.shop-buy-btn {
    width: 100%;
    padding: 0.75rem;
    background: #4f46e5;
    color: white;
    font-family: 'Fredoka One', cursive;
    transition: background 0.2s;
}
.shop-buy-btn:hover:not(:disabled) {
    background: #4338ca;
}
.shop-buy-btn:disabled {
    background: #3730a3;
    opacity: 0.5;
    cursor: not-allowed;
}

/* Inventory Grid in Hero Modal */
.inventory-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    gap: 0.5rem;
    margin-top: 1rem;
}
.inventory-item {
    width: 60px;
    height: 60px;
    border-radius: 0.5rem;
    border: 2px solid #e5e7eb;
    overflow: hidden;
    cursor: help;
    transition: transform 0.2s;
}
.inventory-item:hover {
    transform: scale(1.1);
    border-color: #fbbf24;
    z-index: 10;
}

/* --- COIN INDICATOR STYLES --- */
.coin-pill {
    position: absolute;
    /* Position relative to the card top-center */
    top: 0; 
    left: 50%; 
    /* Move it 40px to the right of the center (clearing the avatar) */
    margin-left: 40px; 
    transform: translateY(-50%); /* Vertically center on the card edge */
    
    background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%);
    border: 2px solid white;
    padding: 0.1rem 0.4rem; /* Smaller padding */
    border-radius: 9999px;
    font-family: 'Fredoka One', cursive;
    color: white;
    font-size: 0.75rem; /* Smaller text */
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    z-index: 15;
    display: flex;
    align-items: center;
    gap: 3px;
    white-space: nowrap;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    pointer-events: none;
}

.coin-pill i {
    color: #fcd34d;
    font-size: 0.65rem; /* Smaller icon */
}

/* Animation for when coins update */
@keyframes coin-pop {
    0% { transform: translateX(-50%) scale(1); filter: brightness(1); }
    50% { transform: translateX(-50%) scale(1.3); filter: brightness(1.3); }
    100% { transform: translateX(-50%) scale(1); filter: brightness(1); }
}

.coin-update-anim {
    animation: coin-pop 0.4s ease-out;
}

/* WALLPAPER MODE STYLES */

/* 1. Enter & Exit Animations */
@keyframes expand-header { 0% { clip-path: inset(0 0 100% 0); opacity: 0; } 100% { clip-path: inset(0 0 0 0); opacity: 1; } }
@keyframes collapse-header { 0% { clip-path: inset(0 0 0 0); opacity: 1; } 100% { clip-path: inset(0 0 100% 0); opacity: 0; } }

.wallpaper-enter { animation: expand-header 1s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
.wallpaper-exit { animation: collapse-header 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

/* 2. Celestial Animations (Day/Night) */
/* Night State Classes (Toggled via JS) */
.is-night #wall-bg-day { opacity: 0; }
.is-night #wall-bg-night { opacity: 1; }
.is-night #wall-sun { top: 110% !important; opacity: 0; } /* Sun Sets */
.is-night #wall-moon { top: 10% !important; } /* Moon Rises */
.is-night #wall-class-badge { background-color: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.2); }
.is-night #wall-class-name { color: #E0E7FF; text-shadow: 0 0 10px rgba(165, 180, 252, 0.5); }
.is-night #wall-class-level { color: #A5B4FC; }

/* 3. Floating Clouds (Extended Range to fix popping) */
@keyframes float-clouds-right { 
    0% { transform: translateX(-150vw); } 
    100% { transform: translateX(150vw); } 
}
@keyframes float-clouds-left { 
    0% { transform: translateX(150vw); } 
    100% { transform: translateX(-150vw); } 
}
#dynamic-wallpaper-screen .fa-cloud { 
    display: inline-block; 
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.1)); 
    will-change: transform; /* Performance optimization */
}

/* 4. Childish & Lively Floating Cards */
.wallpaper-float-card {
    position: absolute;
    width: 360px; /* Slightly wider for new cards */
    padding: 2rem;
    border-radius: 2.5rem; /* Even bubblier */
    box-shadow: 0 25px 60px rgba(0,0,0,0.15), 0 0 0 4px rgba(255,255,255,0.4);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    transition: all 2s cubic-bezier(0.22, 1, 0.36, 1); /* Slower entry/exit */
    z-index: 60;
    animation: float-bob 20s ease-in-out infinite; /* Much slower bob */
}

@keyframes float-bob { 
    0% { transform: translateY(0) rotate(0deg); } 
    33% { transform: translateY(-15px) rotate(1deg); } 
    66% { transform: translateY(10px) rotate(-1deg); } 
    100% { transform: translateY(0) rotate(0deg); } 
}

/* Vibrant Card Themes */
.float-card-blue { 
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(191, 219, 254, 0.9)); 
    border: 4px solid #60A5FA; color: #1E3A8A;
}
.float-card-gold { 
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(253, 230, 138, 0.9)); 
    border: 4px solid #F59E0B; color: #78350F;
}
.float-card-purple { 
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(233, 213, 255, 0.9)); 
    border: 4px solid #A855F7; color: #581C87;
}
.float-card-green { 
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(187, 247, 208, 0.9)); 
    border: 4px solid #22C55E; color: #14532D;
}
.float-card-red { 
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(254, 202, 202, 0.9)); 
    border: 4px solid #EF4444; color: #7F1D1D;
}
.float-card-dark { 
    background: linear-gradient(135deg, rgba(31,41,55,0.95), rgba(17,24,39,0.95)); 
    border: 4px solid #FCD34D; color: white; 
}

/* 5. Center Hub */
@keyframes hub-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
    50% { box-shadow: 0 0 50px 10px rgba(255, 255, 255, 0); }
}
.wall-center-hub {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(8px);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

/* 6. Text Shadows */
.wall-shadow-text { filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2)); }

/* --- Ceremony Updates --- */
.ceremony-card.finalist {
    /* Hide the stars/rank content initially */
    background: linear-gradient(135deg, #1f2937, #111827);
    border-color: #4b5563;
    transform: scale(0.95);
}
.ceremony-card.finalist .reveal-content {
    opacity: 0; 
}
/* Ensure text doesn't overflow */
.ceremony-card h3 {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

/* Wallpaper Card Positioning Fix */
.wallpaper-float-card {
    /* Ensure they stay within bounds */
    max-width: 90vw;
    right: auto; 
    left: 50%;
    transform: translateX(-50%) translateY(40px) scale(0.9);
    /* Dynamic positions handled in JS, but base style safe */
}
