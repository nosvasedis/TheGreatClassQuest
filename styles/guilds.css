/*
 * styles/guilds.css — Guilds & Factions
 * Guild Hall atmosphere, crystal columns, lore overlay, sorting quiz modal, badges
 */

/* ─── Guild badge (student list) ─────────────────────────────────────────── */
.guild-badge           { display: inline-block; flex-shrink: 0; }
.guild-emblem          { border-radius: 9999px; object-fit: cover; }
.guild-badge-wrap      { display: inline-flex; align-items: center; justify-content: center; }

/* ─── Quiz trigger button on student list ───────────────────────────────────*/
.guild-quiz-btn { transition: transform 0.2s, box-shadow 0.2s; }
.guild-quiz-btn:hover {
    transform: scale(1.06);
    box-shadow: 0 4px 14px rgba(124,58,237,0.35);
}


/* ═══════════════════════════════════════════════════════════════════════════
   GUILD HALL TAB LAYOUT
   ═══════════════════════════════════════════════════════════════════════════ */

/* Tab background — transparent so it shows the same background as other tabs */
#guilds-tab {
    padding-bottom: 2rem;
}

/* ── Header: title above the scene ─────────────────────────────────────────── */
.guild-hall-header {
    padding: 1.25rem 1rem 1rem;
}
.guild-hall-crest {
    font-size: 3rem;
    line-height: 1;
    filter: drop-shadow(0 0 14px rgba(124,58,237,0.7));
    animation: crest-pulse 3s ease-in-out infinite alternate;
}
@keyframes crest-pulse {
    from { filter: drop-shadow(0 0 10px rgba(124,58,237,0.5)); transform: scale(1);    }
    to   { filter: drop-shadow(0 0 22px rgba(245,158,11,0.8)); transform: scale(1.05); }
}
.guild-hall-title {
    font-size: clamp(1.8rem, 5vw, 2.8rem);
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 40%, #c084fc 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-top: 0.15rem;
    letter-spacing: 0.03em;
    filter: drop-shadow(0 1px 3px rgba(0,0,0,0.15));
}
.guild-hall-subtitle {
    color: #6b7280;
    font-size: 0.82rem;
    margin-top: 0.35rem;
    line-height: 1.5;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FRAMED SCENE (pure CSS gradient, no image)
   ═══════════════════════════════════════════════════════════════════════════ */

.guild-hall-scene {
    position: relative;
    max-width: min(1140px, calc(100% - 1rem));
    margin: 0 auto;
    border-radius: 1.5rem;
    overflow: hidden;

    /* Deep hall atmosphere — arched-window sky at top, warm floor below */
    background:
        radial-gradient(ellipse 100% 50% at 50%   0%, rgba(88,28,135,0.55)  0, rgba(46,16,101,0.25) 45%, transparent 75%),
        radial-gradient(ellipse  40% 70% at  3%  75%, rgba(245,158,11,0.35) 0, transparent 55%),
        radial-gradient(ellipse  40% 70% at 97%  75%, rgba(234,88,12,0.30)  0, transparent 55%),
        radial-gradient(ellipse  70% 35% at 50% 110%, rgba(180,83,9,0.25)   0, transparent 60%),
        radial-gradient(ellipse  55% 40% at 25%  55%, rgba(30,64,175,0.15)  0, transparent 60%),
        radial-gradient(ellipse  55% 40% at 75%  55%, rgba(30,64,175,0.15)  0, transparent 60%),
        linear-gradient(175deg, #100828 0%, #1e0f3e 35%, #0e1b34 75%, #0a1020 100%);

    /* Layered gold frame — inner glow + outer border */
    box-shadow:
        inset 0 0  80px rgba(88,28,135,0.25),
        inset 0 -50px 80px rgba(180,83,9,0.18),
        inset 0   0 120px rgba(30,64,175,0.10),
        0 0 0 2px  rgba(245,190,70,0.60),
        0 0 0 4px  rgba(245,190,70,0.18),
        0 0 0 7px  rgba(180,83,9,0.12),
        0 0 30px   rgba(124,58,237,0.25),
        0 20px 60px rgba(0,0,0,0.25);
}

/* Full-cover overlay container — holds all animated elements */
.guild-hall-scene-overlay {
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    overflow: hidden;
}

/* ── Torch glows (left & right walls) ──────────────────────────────────────── */
.guild-hall-torch {
    position: absolute;
    top: 15%;
    width: 220px;
    height: 280px;
    border-radius: 9999px;
    filter: blur(65px);
    animation: torch-flicker 2.8s ease-in-out infinite alternate;
}
.guild-hall-torch--left  {
    left: -55px;
    background: radial-gradient(ellipse at 70% 40%, rgba(245,158,11,0.65) 0, transparent 62%);
}
.guild-hall-torch--right {
    right: -55px;
    background: radial-gradient(ellipse at 30% 40%, rgba(234,88,12,0.60) 0, transparent 62%);
    animation-delay: 0.75s;
}
@keyframes torch-flicker {
    0%   { opacity: 0.50; transform: scaleX(0.86) scaleY(0.93); }
    30%  { opacity: 1.00; transform: scaleX(1.08) scaleY(1.04); }
    65%  { opacity: 0.68; transform: scaleX(0.92) scaleY(0.96); }
    100% { opacity: 1.00; transform: scaleX(1.00) scaleY(1.00); }
}

/* ── Star-field (tiny white dots twinkling) ─────────────────────────────────── */
.guild-hall-stars-field {
    position: absolute;
    inset: 0;
    background-image:
        radial-gradient(circle, rgba(255,255,255,0.7) 1px, transparent 1px),
        radial-gradient(circle, rgba(255,255,255,0.4) 1px, transparent 1px),
        radial-gradient(circle, rgba(200,180,255,0.5) 1px, transparent 1px);
    background-size: 110px 90px, 170px 140px, 80px 70px;
    background-position: 15px 20px, 60px 50px, 90px 8px;
    opacity: 0.6;
    animation: stars-twinkle 6s ease-in-out infinite alternate;
}
@keyframes stars-twinkle {
    from { opacity: 0.35; }
    to   { opacity: 0.70; }
}

/* ── Rising ember sparks ────────────────────────────────────────────────────── */
.guild-hall-embers {
    position: absolute;
    inset: 0;
    overflow: hidden;
}
.guild-hall-embers span {
    position: absolute;
    bottom: -6px;
    left: var(--x, 50%);
    width:  var(--s, 3px);
    height: var(--s, 3px);
    border-radius: 50%;
    background: var(--c, rgba(245,158,11,0.9));
    box-shadow: 0 0 6px 1px var(--c, rgba(245,158,11,0.6));
    animation: ember-rise var(--d, 3s) var(--dl, 0s) ease-out infinite;
    opacity: 0;
}
@keyframes ember-rise {
    0%   { transform: translateY(0)    translateX(0px);  opacity: 0;   }
    8%   { opacity: 1;                                                  }
    50%  { transform: translateY(-45%) translateX(6px);  opacity: 0.7; }
    100% { transform: translateY(-105vh) translateX(-4px); opacity: 0; }
}

/* ── Faint rising glow orbs ─────────────────────────────────────────────────── */
.guild-hall-glows {
    position: absolute;
    inset: 0;
    overflow: hidden;
}
.guild-hall-glows span {
    position: absolute;
    bottom: -80px;
    left: var(--x, 50%);
    margin-left: -90px;
    width: 180px;
    height: 180px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--c, rgba(124,58,237,0.2)) 0%, transparent 70%);
    filter: blur(22px);
    animation: glow-rise var(--d, 7s) var(--dl, 0s) ease-in-out infinite;
    opacity: 0;
}
@keyframes glow-rise {
    0%   { transform: translateY(0);    opacity: 0;   }
    12%  { opacity: 1;                                }
    80%  { opacity: 0.55;                             }
    100% { transform: translateY(-110%); opacity: 0;  }
}

/* Content wrapper (crystal columns) — above all atmospheric layers */
.guild-hall-scene-content {
    position: relative;
    z-index: 2;
    padding: 1.5rem 1.25rem 1.75rem;
}


/* ═══════════════════════════════════════════════════════════════════════════
   CRYSTAL TOWER RANKINGS
   ═══════════════════════════════════════════════════════════════════════════ */

.guild-crystal-arena {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    justify-content: center;
    gap: 1rem;
    padding: 0;
    width: 100%;
    max-width: none;
    margin: 0 auto;
}

/* ── Each guild column ─────────────────────────────────────────────────────── */
.guild-crystal-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    min-width: 0;
    max-width: 210px;
    gap: 0;
    transition: filter 0.35s ease;
}

/* Dim other columns when one is active */
.guild-crystal-arena:has(.guild-active) .guild-crystal-col:not(.guild-active) {
    filter: brightness(0.55) saturate(0.5);
}

/* Rank medal */
.guild-crystal-rank {
    font-size: 1.75rem;
    line-height: 1;
    margin-bottom: 0.25rem;
    filter: drop-shadow(0 2px 6px rgba(0,0,0,0.4));
}

/* ── Header (fixed min-height ensures all columns align at tube top) ───────── */
.guild-crystal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 170px;
    justify-content: flex-end;
    padding-bottom: 0.6rem;
    gap: 0.3rem;
    width: 100%;
}

/* ── Emblem wrapper (click target) ─────────────────────────────────────────── */
.guild-crystal-emblem-wrapper {
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    outline: none;
}
.guild-crystal-emblem-wrapper:focus-visible {
    outline: 2px dashed rgba(255,255,255,0.5);
    outline-offset: 4px;
    border-radius: 9999px;
}

/* Emblem image */
.guild-crystal-emblem {
    width: 118px;
    height: 118px;
    border-radius: 9999px;
    object-fit: cover;
    border: 3.5px solid transparent;
    transition: transform 0.45s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.35s ease;
    position: relative;
    z-index: 2;
}
.guild-crystal-emblem-fallback {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 118px;
    height: 118px;
    border-radius: 9999px;
    border: 3.5px solid rgba(255,255,255,0.3);
    transition: transform 0.45s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.35s ease;
    position: relative;
    z-index: 2;
}

/* Animated ring that glows on hover/active */
.guild-emblem-ring {
    position: absolute;
    inset: -8px;
    border-radius: 9999px;
    border: 2.5px solid transparent;
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.45s cubic-bezier(0.34,1.56,0.64,1);
    pointer-events: none;
    z-index: 1;
}
.guild-crystal-emblem-wrapper:hover .guild-emblem-ring,
.guild-active .guild-emblem-ring {
    opacity: 1;
    animation: ring-spin 2.5s linear infinite;
}
@keyframes ring-spin {
    from { transform: rotate(0deg);   }
    to   { transform: rotate(360deg); }
}


/* Grow on active */
.guild-active .guild-crystal-emblem,
.guild-active .guild-crystal-emblem-fallback {
    transform: scale(1.85);
    box-shadow: 0 0 50px var(--glow-color, rgba(255,255,255,0.5)),
                0 0 100px var(--glow-color, rgba(255,255,255,0.25)) !important;
}

/* Hover (not active) */
.guild-crystal-emblem-wrapper:hover .guild-crystal-emblem,
.guild-crystal-emblem-wrapper:hover .guild-crystal-emblem-fallback {
    transform: scale(1.12);
}

/* Guild name */
.guild-crystal-name {
    font-family: 'Fredoka One', cursive;
    font-size: 1.05rem;
    font-weight: 700;
    text-align: center;
    line-height: 1.2;
    margin-top: 0.6rem;
    text-shadow: 0 1px 6px rgba(0,0,0,0.5);
}

/* ── Crystal tube wrap (fixed height → tubes always same size + position) ─── */
.guild-crystal-tube-wrap {
    position: relative;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 320px;
    width: 100%;
    padding-top: 0.25rem;
    padding-bottom: 18px;   /* room for the pedestal glow below */
}

/* Pedestal base glow — absolutely positioned so it doesn't displace the tube */
.guild-crystal-tube-wrap::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 90px;
    height: 14px;
    border-radius: 50%;
    background: radial-gradient(ellipse, rgba(255,200,80,0.50) 0%, transparent 70%);
    filter: blur(4px);
    animation: pedestal-glow 2.5s ease-in-out infinite alternate;
}
@keyframes pedestal-glow {
    from { opacity: 0.5; transform: translateX(-50%) scaleX(0.9); }
    to   { opacity: 1.0; transform: translateX(-50%) scaleX(1.1); }
}

/* Glass tube body */
.guild-crystal-tube {
    position: relative;
    width: 56px;
    height: 100%;
    border-radius: 9999px;
    border: 2.5px solid rgba(200,200,255,0.25);
    background: linear-gradient(
        to bottom,
        rgba(255,255,255,0.18) 0%,
        rgba(220,230,255,0.08) 50%,
        rgba(200,215,255,0.05) 100%
    );
    overflow: hidden;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
}

/* Crystal / gem fill */
.guild-crystal-fill {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 5%;
    border-radius: inherit;
    transition: height 1.5s cubic-bezier(0.34, 1.3, 0.64, 1);
    will-change: height;
}

/* Moving shimmer sweep */
.guild-crystal-shimmer {
    position: absolute;
    inset: 0;
    background: linear-gradient(
        115deg,
        transparent    30%,
        rgba(255,255,255,0.5) 50%,
        transparent    70%
    );
    background-size: 200% 100%;
    animation: crystal-shimmer 2s linear infinite;
    border-radius: inherit;
}
@keyframes crystal-shimmer {
    0%   { background-position: -200% 0; }
    100% { background-position:  200% 0; }
}

/* Rising bubbles */
.guild-crystal-bubbles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
}
.guild-bubble {
    position: absolute;
    bottom: 2px;
    left: var(--left, 30%);
    width:  var(--size, 5px);
    height: var(--size, 5px);
    border-radius: 50%;
    animation: bubble-rise 2.4s var(--delay, 0s) ease-in infinite;
    opacity: 0;
}
@keyframes bubble-rise {
    0%   { bottom: 4px;  opacity: 0;   }
    15%  { opacity: 0.8; }
    85%  { opacity: 0.3; }
    100% { bottom: 96%;  opacity: 0;   }
}

/* Glass highlight streak */
.guild-crystal-glass-shine {
    position: absolute;
    top: 3%;
    left: 18%;
    width: 26%;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.55) 0%, transparent 100%);
    border-radius: 9999px;
    pointer-events: none;
}

/* Soft glow at the top of the tube */
.guild-crystal-glow-top {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40%;
    pointer-events: none;
    border-radius: inherit;
}

/* ── Bottom stats ─────────────────────────────────────────────────────────── */
.guild-crystal-count {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 0.85rem;
    gap: 0.05rem;
}
.guild-crystal-count-num {
    font-family: 'Fredoka One', cursive;
    font-size: 1.9rem;
    font-weight: 700;
    line-height: 1;
    text-shadow: 0 1px 6px rgba(0,0,0,0.4);
}
.guild-crystal-count-label {
    font-size: 0.65rem;
    color: rgba(255,255,255,0.5);
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
}
.guild-crystal-members {
    font-size: 0.72rem;
    color: rgba(255,255,255,0.4);
    margin-top: 0.15rem;
}

/* Top heroes */
.guild-crystal-heroes {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    margin-top: 0.6rem;
    width: 100%;
    min-height: 60px; /* keeps layout consistent when empty */
}
.guild-crystal-heroes-label {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.45);
    text-transform: uppercase;
    letter-spacing: 0.07em;
}
.guild-crystal-hero-chip {
    font-size: 0.68rem;
    padding: 0.15rem 0.6rem;
    border-radius: 9999px;
    border: 1px solid;
    background: rgba(255,255,255,0.08);
    white-space: nowrap;
    max-width: 140px;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Responsive: 2-column grid on small screens */
@media (max-width: 600px) {
    .guild-crystal-arena {
        flex-wrap: wrap;
        gap: 1.5rem 0.75rem;
    }
    .guild-crystal-col        { flex: 1 1 calc(50% - 0.75rem); max-width: none; }
    .guild-crystal-tube-wrap  { height: 220px; }
    .guild-crystal-header     { min-height: 150px; }
    .guild-crystal-emblem,
    .guild-crystal-emblem-fallback { width: 84px; height: 84px; }
}


/* ═══════════════════════════════════════════════════════════════════════════
   ANTHEM NOTE BUTTON  (badge at lower-left of the circular emblem)
   ═══════════════════════════════════════════════════════════════════════════ */

/*
 * The button lives inside .guild-crystal-emblem-wrapper (position:relative).
 * The emblem is a 118×118 circle. Placing the button at bottom:-5px / left:-5px
 * puts its centre at ~(6px, 112px) from the wrapper origin — well outside the
 * arc at the 7-o'clock position, so it never overlaps the emblem art itself.
 */
.guild-anthem-btn {
    position: absolute;
    bottom: -5px;
    left: -5px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    border: 1.5px solid rgba(255,255,255,0.45);
    background: rgba(8, 4, 22, 0.80);
    color: rgba(255,255,255,0.85);
    font-size: 0.6rem;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    padding: 0;
    box-shadow: 0 1px 6px rgba(0,0,0,0.55);
    transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
}
.guild-anthem-btn:hover {
    background: var(--anthem-color, #7c3aed);
    border-color: rgba(255,255,255,0.75);
    box-shadow: 0 0 10px var(--anthem-glow, rgba(124,58,237,0.8));
    transform: scale(1.22);
}
.guild-anthem-btn:active {
    transform: scale(0.92);
}

@media (max-width: 600px) {
    .guild-anthem-btn {
        width: 19px;
        height: 19px;
        font-size: 0.55rem;
        bottom: -4px;
        left: -4px;
    }
}


/* ═══════════════════════════════════════════════════════════════════════════
   GUILD ANTHEM MODAL
   ═══════════════════════════════════════════════════════════════════════════ */

.guild-anthem-overlay {
    position: fixed;
    inset: 0;
    z-index: 210;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.25rem;
}
.guild-anthem-overlay.hidden { display: none; }

.guild-anthem-overlay-bg {
    position: absolute;
    inset: 0;
    background: rgba(5, 2, 18, 0.82);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
}

/* Modal card */
.guild-anthem-card {
    position: relative;
    z-index: 1;
    border-radius: 2rem;
    padding: 2rem 1.75rem 1.75rem;
    max-width: 420px;
    width: 100%;
    max-height: 88vh;
    overflow-y: auto;
    color: #fff;
    text-align: center;
    border: 1.5px solid rgba(255,255,255,0.2);
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.2) transparent;
}
.guild-anthem-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 45%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.1), transparent);
    border-radius: 2rem 2rem 0 0;
    pointer-events: none;
}

/* Close button */
.guild-anthem-close {
    position: absolute;
    top: 0.9rem;
    right: 1rem;
    background: rgba(255,255,255,0.18);
    border: none;
    color: rgba(255,255,255,0.85);
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.85rem;
    transition: background 0.2s, transform 0.15s;
    z-index: 2;
}
.guild-anthem-close:hover { background: rgba(255,255,255,0.32); transform: scale(1.1); }

/* Header */
.guild-anthem-header { margin-bottom: 1rem; }
.guild-anthem-note-icon {
    font-size: 2.2rem;
    line-height: 1;
    margin-bottom: 0.35rem;
    filter: drop-shadow(0 0 12px rgba(255,255,255,0.5));
    animation: anthem-note-bounce 1.2s ease-in-out infinite alternate;
}
@keyframes anthem-note-bounce {
    from { transform: scale(1)    rotate(-5deg); }
    to   { transform: scale(1.12) rotate(5deg);  }
}
.guild-anthem-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.65rem;
    color: #fff;
    text-shadow: 0 2px 10px rgba(0,0,0,0.4);
    margin: 0;
}
.guild-anthem-subtitle {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.7);
    margin-top: 0.2rem;
    font-style: italic;
}

/* Now playing bar */
.guild-anthem-player {
    margin: 0.75rem 0 1.25rem;
}
.guild-anthem-now-playing {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 9999px;
    padding: 0.3rem 1rem;
    font-size: 0.78rem;
    color: rgba(255,255,255,0.85);
}
.guild-anthem-note-anim {
    font-size: 1rem;
    animation: note-float 1.4s ease-in-out infinite alternate;
    display: inline-block;
}
@keyframes note-float {
    from { transform: translateY(0)   rotate(-8deg); opacity: 0.7; }
    to   { transform: translateY(-4px) rotate(8deg); opacity: 1;   }
}
.guild-anthem-now-playing-text {
    letter-spacing: 0.04em;
}

/* Lyrics container */
.guild-anthem-lyrics {
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

/* Verse block */
.guild-anthem-verse {
    background: rgba(0,0,0,0.18);
    border-radius: 1rem;
    padding: 0.9rem 1rem;
    border: 1px solid rgba(255,255,255,0.12);
}

/* Chorus block — slightly more prominent */
.guild-anthem-chorus {
    background: rgba(255,255,255,0.14);
    border-radius: 1rem;
    padding: 0.9rem 1rem;
    border: 1px solid rgba(255,255,255,0.28);
    box-shadow: inset 0 0 20px rgba(255,255,255,0.05);
}

/* Section label (Verse / Chorus) */
.guild-anthem-section-label {
    display: block;
    font-size: 0.62rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(255,255,255,0.55);
    font-weight: 700;
    margin-bottom: 0.45rem;
}
.guild-anthem-chorus .guild-anthem-section-label {
    color: rgba(255,255,255,0.75);
}

/* Each line of lyrics */
.guild-anthem-line {
    margin: 0 0 0.3rem;
    font-size: 0.92rem;
    line-height: 1.6;
    color: rgba(255,255,255,0.92);
    font-weight: 500;
    border-radius: 0.5rem;
    padding: 0.1rem 0.4rem;
    transition:
        opacity      0.35s ease,
        transform    0.35s cubic-bezier(0.34,1.56,0.64,1),
        font-size    0.25s ease,
        font-weight  0.25s ease,
        text-shadow  0.35s ease,
        background   0.35s ease,
        color        0.25s ease;
}
.guild-anthem-chorus .guild-anthem-line {
    color: #fff;
    font-weight: 600;
    font-size: 0.97rem;
}
.guild-anthem-line:last-child { margin-bottom: 0; }

/* ── Karaoke states ─────────────────────────────────────── */

/* Lines not yet reached: softly dimmed */
.guild-anthem-line.karaoke-upcoming {
    opacity: 0.45;
}

/* Lines already sung: faded out */
.guild-anthem-line.karaoke-past {
    opacity: 0.2;
    transform: scale(0.97);
}

/* Currently singing: bright, glowing, slightly larger */
.guild-anthem-line.karaoke-active {
    opacity: 1;
    color: #fff;
    font-size: 1.05rem;
    font-weight: 700;
    transform: scale(1.04) translateX(3px);
    background: rgba(255,255,255,0.15);
    text-shadow:
        0 0 12px rgba(255,255,255,0.9),
        0 0 28px rgba(255,255,255,0.4);
}
.guild-anthem-chorus .guild-anthem-line.karaoke-active {
    font-size: 1.1rem;
    background: rgba(255,255,255,0.22);
    text-shadow:
        0 0 16px rgba(255,255,255,1),
        0 0 36px rgba(255,255,255,0.5);
}

/* Bouncing note prefix on the active line */
.guild-anthem-line.karaoke-active::before {
    content: '♪ ';
    display: inline;
    animation: karaoke-note-pulse 0.55s ease-in-out infinite alternate;
}
@keyframes karaoke-note-pulse {
    from { opacity: 0.6; transform: scale(0.85) rotate(-8deg); }
    to   { opacity: 1;   transform: scale(1.15) rotate(8deg);  }
}


/* ═══════════════════════════════════════════════════════════════════════════
   GUILD LORE OVERLAY (shown on emblem click)
   ═══════════════════════════════════════════════════════════════════════════ */

.guild-lore-overlay {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
}
.guild-lore-overlay.hidden { display: none; }

.guild-lore-overlay-bg {
    position: absolute;
    inset: 0;
    background: rgba(5, 2, 18, 0.78);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

/* Lore card */
.guild-lore-card {
    position: relative;
    z-index: 1;
    border-radius: 2rem;
    padding: 2.25rem 2rem 2rem;
    max-width: 380px;
    width: 100%;
    color: #fff;
    text-align: center;
    overflow: hidden;
    border: 1.5px solid rgba(255,255,255,0.18);
}
.guild-lore-card::before {
    /* Subtle glass inner highlight */
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 50%;
    background: linear-gradient(to bottom, rgba(255,255,255,0.1), transparent);
    border-radius: 2rem 2rem 0 0;
    pointer-events: none;
}

/* Close button */
.guild-lore-close {
    position: absolute;
    top: 0.9rem;
    right: 1rem;
    background: rgba(255,255,255,0.18);
    border: none;
    color: rgba(255,255,255,0.85);
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.85rem;
    transition: background 0.2s, transform 0.15s;
    z-index: 2;
}
.guild-lore-close:hover { background: rgba(255,255,255,0.32); transform: scale(1.1); }

/* Sparkles row */
.guild-lore-sparkles {
    display: flex;
    justify-content: center;
    gap: 0.8rem;
    font-size: 1rem;
    margin-bottom: 0.75rem;
    color: rgba(255,255,255,0.7);
    animation: lore-sparkle-dance 1.8s ease-in-out infinite alternate;
}
@keyframes lore-sparkle-dance {
    from { letter-spacing: 0.8rem; opacity: 0.6; }
    to   { letter-spacing: 1.2rem; opacity: 1;   }
}

/* Emblem */
.guild-lore-emblem-wrap { display: flex; justify-content: center; margin-bottom: 0.5rem; }
.guild-lore-emblem {
    width: 110px;
    height: 110px;
    border-radius: 9999px;
    object-fit: cover;
    border: 4px solid rgba(255,255,255,0.45);
    animation: lore-emblem-pulse 2s ease-in-out infinite;
}
.guild-lore-emblem-fallback {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 110px;
    height: 110px;
    border-radius: 9999px;
    border: 4px solid rgba(255,255,255,0.35);
    animation: lore-emblem-pulse 2s ease-in-out infinite;
}
@keyframes lore-emblem-pulse {
    0%, 100% { box-shadow: 0 0 24px var(--lore-glow, rgba(255,255,255,0.3)); transform: scale(1);    }
    50%      { box-shadow: 0 0 48px var(--lore-glow, rgba(255,255,255,0.5)); transform: scale(1.04); }
}

.guild-lore-emoji {
    font-size: 1.6rem;
    margin-top: 0.5rem;
    filter: drop-shadow(0 0 8px rgba(255,255,255,0.5));
}
.guild-lore-name {
    font-family: 'Fredoka One', cursive;
    font-size: 2rem;
    color: #fff;
    text-shadow: 0 2px 10px rgba(0,0,0,0.4);
    margin: 0.25rem 0;
}
.guild-lore-motto {
    font-size: 0.9rem;
    color: rgba(255,255,255,0.8);
    font-style: italic;
    margin-bottom: 1rem;
    line-height: 1.5;
}

/* Trait badges */
.guild-lore-traits {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.45rem;
    margin-bottom: 1rem;
}
.guild-lore-trait {
    padding: 0.25rem 0.9rem;
    border-radius: 9999px;
    border: 1.5px solid;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.03em;
}

/* Stars / member stats */
.guild-lore-stats {
    display: flex;
    justify-content: center;
    gap: 1.25rem;
}
.guild-lore-stat {
    font-size: 0.82rem;
    color: rgba(255,255,255,0.75);
}
.guild-lore-stat strong {
    color: #fff;
    font-size: 1rem;
}


/* ═══════════════════════════════════════════════════════════════════════════
   SORTING QUIZ MODAL
   ═══════════════════════════════════════════════════════════════════════════ */

.sorting-quiz-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(15,10,30,0.82);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}

.sorting-quiz-card {
    position: relative;
    z-index: 1;
    background: linear-gradient(145deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
    border: 1.5px solid rgba(167,139,250,0.35);
    border-radius: 1.75rem;
    padding: 2rem 2rem 1.75rem;
    max-width: 520px;
    width: 100%;
    box-shadow:
        0 0 0 1px rgba(167,139,250,0.15),
        0 25px 60px rgba(0,0,0,0.6),
        0 0 80px rgba(124,58,237,0.2);
    color: white;
}

/* pop-in (shared with result card) */
.pop-in {
    animation: quiz-pop-in 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes quiz-pop-in {
    from { opacity: 0; transform: scale(0.88) translateY(16px); }
    to   { opacity: 1; transform: scale(1)    translateY(0);    }
}

/* Header */
.sorting-quiz-header  { text-align: center; margin-bottom: 1rem; }
.sorting-quiz-question-emoji {
    font-size: 3rem;
    line-height: 1;
    margin-bottom: 0.3rem;
    display: block;
    filter: drop-shadow(0 0 12px rgba(251,191,36,0.5));
    transition: all 0.3s ease;
}
.sorting-quiz-title    { font-family: 'Fredoka One', cursive; font-size: 1.4rem; color: #e9d5ff; letter-spacing: 0.04em; }
.sorting-quiz-subtitle { font-size: 0.78rem; color: #a78bfa; margin-top: 0.15rem; }

/* Progress dots */
.sorting-quiz-dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.6rem;
}
.sorting-quiz-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(167,139,250,0.25);
    border: 1.5px solid rgba(167,139,250,0.4);
    transition: all 0.3s ease;
}
.sorting-quiz-dot--done   { background: #7c3aed; border-color: #7c3aed; transform: scale(0.85); }
.sorting-quiz-dot--active { background: #fbbf24; border-color: #fbbf24; box-shadow: 0 0 8px #fbbf2488; transform: scale(1.2); }

/* Progress bar (subtle) */
.sorting-quiz-progress-bar {
    width: 100%;
    height: 3px;
    background: rgba(167,139,250,0.2);
    border-radius: 9999px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}
.sorting-quiz-progress-fill {
    height: 100%;
    background: linear-gradient(to right, #7c3aed, #ec4899);
    border-radius: 9999px;
    transition: width 0.4s ease;
}
.sorting-quiz-progress-text {
    text-align: center;
    font-size: 0.72rem;
    color: #a78bfa;
    margin-bottom: 0.75rem;
    letter-spacing: 0.05em;
}

/* Question */
.sorting-quiz-question-wrap { margin-bottom: 1.25rem; }
.sorting-quiz-question-text {
    font-size: 1.15rem;
    font-weight: 600;
    color: #f3f4f6;
    text-align: center;
    margin-bottom: 1rem;
    line-height: 1.45;
}

/* Options — single column for all levels (option text can be long) */
.sorting-quiz-options-grid {
    display: flex;
    flex-direction: column;
    gap: 0.55rem;
}
.sorting-quiz-option {
    display: flex;
    align-items: center;
    gap: 0.65rem;
    padding: 0.75rem 1rem;
    border-radius: 1rem;
    border: 1.5px solid rgba(167,139,250,0.25);
    background: rgba(255,255,255,0.05);
    color: #e2e8f0;
    font-size: 0.9rem;
    text-align: left;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s, transform 0.15s, box-shadow 0.2s;
    line-height: 1.4;
    width: 100%;
}
.sorting-quiz-option:hover {
    border-color: rgba(167,139,250,0.6);
    background: rgba(124,58,237,0.18);
    transform: translateX(3px);
    box-shadow: 0 4px 14px rgba(124,58,237,0.25);
}
.sorting-quiz-option--selected {
    border-color: #fbbf24 !important;
    background: rgba(251,191,36,0.15) !important;
    box-shadow: 0 0 0 2px rgba(251,191,36,0.35), 0 4px 14px rgba(251,191,36,0.2) !important;
    transform: translateX(3px);
}
.sorting-quiz-option-label {
    flex-shrink: 0;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(167,139,250,0.2);
    font-size: 0.72rem;
    font-weight: 700;
    color: #c4b5fd;
    border: 1px solid rgba(167,139,250,0.3);
    transition: background 0.2s, color 0.2s, transform 0.15s;
}
.sorting-quiz-option--selected .sorting-quiz-option-label {
    background: #fbbf24;
    color: #1e1b4b;
    border-color: #fbbf24;
    transform: scale(1.15);
}
.sorting-quiz-option-text {
    flex: 1;
    font-size: 0.88rem;
    line-height: 1.45;
}

/* Question slide-in animation (triggered by JS adding the class) */
@keyframes quiz-question-in {
    from { opacity: 0; transform: translateX(20px); }
    to   { opacity: 1; transform: translateX(0); }
}
.sorting-quiz-question-entering {
    animation: quiz-question-in 0.28s cubic-bezier(0.34, 1.1, 0.64, 1);
}

/* Randomised badge shown in subtitle */
.sorting-quiz-random-badge {
    display: inline-block;
    background: rgba(251,191,36,0.15);
    border: 1px solid rgba(251,191,36,0.35);
    border-radius: 9999px;
    padding: 0.1rem 0.55rem;
    font-size: 0.68rem;
    color: #fbbf24;
    letter-spacing: 0.04em;
    margin-top: 0.25rem;
}

/* Footer buttons */
.sorting-quiz-footer { display: flex; gap: 0.75rem; }
.sorting-quiz-btn {
    flex: 1;
    padding: 0.65rem 1rem;
    border-radius: 1rem;
    font-family: 'Fredoka One', cursive;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
    letter-spacing: 0.02em;
    border: none;
}
.sorting-quiz-btn:hover   { transform: translateY(-1px); }
.sorting-quiz-btn:active  { transform: translateY(1px);  }
.sorting-quiz-btn:disabled{ opacity: 0.45; cursor: not-allowed; transform: none; }
.sorting-quiz-btn--cancel {
    background: rgba(255,255,255,0.1);
    color: #d1d5db;
    border: 1.5px solid rgba(255,255,255,0.15);
}
.sorting-quiz-btn--cancel:hover { background: rgba(255,255,255,0.18); }
.sorting-quiz-btn--next {
    background: linear-gradient(135deg, #7c3aed, #ec4899);
    color: white;
    box-shadow: 0 4px 16px rgba(124,58,237,0.45);
}
.sorting-quiz-btn--next:hover { box-shadow: 0 6px 20px rgba(124,58,237,0.6); }
.sorting-quiz-btn--done {
    width: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.15));
    color: white;
    border: 1.5px solid rgba(255,255,255,0.5);
    box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}
.sorting-quiz-btn--done:hover {
    background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.25));
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
}

/* Result modal card */
.sorting-quiz-result-card {
    position: relative;
    z-index: 1;
    border-radius: 1.75rem;
    padding: 2rem 2rem 1.75rem;
    max-width: 400px;
    width: 100%;
    box-shadow:
        0 0 0 1px rgba(255,255,255,0.15),
        0 25px 60px rgba(0,0,0,0.6),
        0 0 60px var(--guild-glow, #7c3aed44);
    text-align: center;
    color: white;
    overflow: hidden;
}
.sorting-quiz-result-sparkles {
    display: flex;
    justify-content: center;
    gap: 1rem;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    animation: sparkle-dance 1.5s ease-in-out infinite alternate;
    opacity: 0.85;
}
@keyframes sparkle-dance {
    from { letter-spacing: 1rem;   opacity: 0.7; }
    to   { letter-spacing: 1.4rem; opacity: 1;   }
}
.sorting-quiz-result-title {
    font-family: 'Fredoka One', cursive;
    font-size: 1.5rem;
    color: rgba(255,255,255,0.95);
    margin-bottom: 1rem;
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.sorting-quiz-result-emblem-wrap { display: flex; justify-content: center; margin-bottom: 1rem; }
.sorting-quiz-result-emblem {
    width: 100px;
    height: 100px;
    border-radius: 9999px;
    object-fit: cover;
    border: 4px solid rgba(255,255,255,0.5);
    animation: result-emblem-pulse 2s ease-in-out infinite;
}
.sorting-quiz-result-emblem-fallback {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100px;
    height: 100px;
    border-radius: 9999px;
    border: 4px solid rgba(255,255,255,0.4);
    animation: result-emblem-pulse 2s ease-in-out infinite;
}
@keyframes result-emblem-pulse {
    0%, 100% { box-shadow: 0 0 20px var(--guild-glow, rgba(255,255,255,0.3)); transform: scale(1);    }
    50%      { box-shadow: 0 0 40px var(--guild-glow, rgba(255,255,255,0.5)); transform: scale(1.04); }
}
.sorting-quiz-result-guild-name {
    font-family: 'Fredoka One', cursive;
    font-size: 1.8rem;
    color: white;
    margin-bottom: 0.3rem;
    text-shadow: 0 2px 12px rgba(0,0,0,0.4);
}
.sorting-quiz-result-motto  { font-size: 0.85rem; color: rgba(255,255,255,0.75); font-style: italic; margin-bottom: 0.9rem; }
.sorting-quiz-result-msg    { font-size: 0.85rem; color: rgba(255,255,255,0.8);  margin-bottom: 1.25rem; line-height: 1.5; }
